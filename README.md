# ğŸ—¾ ì¼ë³¸ì–´ íšŒí™” í•™ìŠµ ì•± (NihonGo Conversation)

[![Kotlin](https://img.shields.io/badge/kotlin-1.9.0-blue.svg)](https://kotlinlang.org)
[![Android](https://img.shields.io/badge/Android-API_24+-green.svg)](https://developer.android.com)
[![Gemini](https://img.shields.io/badge/Gemini-2.5_Flash-purple.svg)](https://ai.google.dev)

AI ê¸°ë°˜ ì¼ë³¸ì–´ íšŒí™” í•™ìŠµì„ ìœ„í•œ ê°œì¸ìš© Android ì• í”Œë¦¬ì¼€ì´ì…˜

## ğŸŒŸ ì£¼ìš” ê¸°ëŠ¥

- ğŸ¤– **AI ëŒ€í™” íŒŒíŠ¸ë„ˆ**: Gemini 2.5 Flashë¥¼ í™œìš©í•œ ìì—°ìŠ¤ëŸ¬ìš´ ì¼ë³¸ì–´ ëŒ€í™”
- ğŸ’­ **ë§¥ë½ ê¸°ì–µ**: ì´ì „ ëŒ€í™”ë¥¼ ê¸°ì–µí•˜ê³  ê´€ê³„ë¥¼ ì´ì–´ê°€ëŠ” ì¹œêµ¬ ê°™ì€ AI
- ğŸ’¡ **AI íŒíŠ¸ ì‹œìŠ¤í…œ**: í•œêµ­ì–´-ì¼ë³¸ì–´ ë²ˆì—­ íŒíŠ¸, ë¡œë§ˆì í‘œê¸°, ë¬¸ë§¥ ê¸°ë°˜ ì œì•ˆ
- ğŸ“– **ë¬¸ë²• ì„¤ëª… ê¸°ëŠ¥**: ë©”ì‹œì§€ ê¸¸ê²Œ ëˆ„ë¥´ê¸°ë¡œ ì¦‰ì‹œ ë¬¸ë²• ë¶„ì„, ìƒ‰ìƒë³„ êµ¬ë¬¸ ê°•ì¡°, ìºì‹±ìœ¼ë¡œ ì¦‰ì‹œ ì¬ë¡œë”©
- ğŸŒ **ë©”ì‹œì§€ë³„ ë²ˆì—­**: ê° AI ë©”ì‹œì§€ë§ˆë‹¤ í•œêµ­ì–´ ë²ˆì—­ ë²„íŠ¼, ì„ íƒì  ë²ˆì—­ í™•ì¸
- ğŸ’¾ **ëŒ€í™” ê´€ë¦¬**: ëŒ€í™” ì¢…ë£Œ ë²„íŠ¼, íˆìŠ¤í† ë¦¬ ìë™ ì €ì¥, ìƒˆ ëŒ€í™” ì‹œì‘ ê¸°ëŠ¥
- ğŸ­ **6ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤**: ë ˆìŠ¤í† ë‘, ì‡¼í•‘, í˜¸í…”, ì¹œêµ¬ ë§Œë“¤ê¸°, ì „í™” ëŒ€í™”, ë³‘ì› (ì´ˆê¸‰/ì¤‘ê¸‰/ìƒê¸‰)
- ğŸ™ï¸ **ìŒì„± ì§€ì›**: STTë¡œ ì¼ë³¸ì–´ ìŒì„± ì¸ì‹, TTSë¡œ AI ì‘ë‹µ ìë™ ì¬ìƒ, ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- ğŸ¤ **ë°œìŒ ì—°ìŠµ**: AI ë©”ì‹œì§€ ë°œìŒ í‰ê°€, 0-100 ì •í™•ë„ ì ìˆ˜, ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ ë¶„ì„, ìƒ‰ìƒ í”¼ë“œë°±
- ğŸ“š **í”Œë˜ì‹œì¹´ë“œ ì‹œìŠ¤í…œ**: ìë™ ì–´íœ˜ ì¶”ì¶œ, SM-2 ê°„ê²© ë°˜ë³µ ì•Œê³ ë¦¬ì¦˜, ë§ˆìŠ¤í„°ë¦¬ ì¶”ì , ë³µìŠµ í†µê³„
- ğŸ“œ **ëŒ€í™” ì´ë ¥**: ì „ì²´ ëŒ€í™” ê²€ìƒ‰/í•„í„°ë§, ìƒíƒœë³„ ë³´ê¸°, ë¹ ë¥¸ ì¬ê°œ, ì‚­ì œ ê´€ë¦¬
- âš™ï¸ **ì„¤ì • ì‹œìŠ¤í…œ**: ë‚œì´ë„ ì¡°ì ˆ (1-3), ìŒì„± ì†ë„ (0.5x-2.0x), ìë™ ì½ê¸°, ë¡œë§ˆì í‘œì‹œ
- ğŸ¯ **ë‚œì´ë„ ì¡°ì ˆ**: JLPT ë ˆë²¨ë³„ AI ì‘ë‹µ (N5-N4/N3-N2/N1), ì–´íœ˜ ë³µì¡ë„ ë¶„ì„, ë³„ì  í‘œì‹œ
- ğŸ“Š **í•™ìŠµ í†µê³„**: ì¼ì¼/ì£¼ê°„/ì›”ê°„ ì§„ë„, ì—°ì† í•™ìŠµì¼ ì¶”ì , ì‹œë‚˜ë¦¬ì˜¤ë³„ ì§„í–‰ë¥ , ì°¨íŠ¸ ì‹œê°í™”
- ğŸ”¥ **ë³µìŠµ ëª¨ë“œ**: ì™„ë£Œëœ ëŒ€í™”ë§Œ í‘œì‹œ, í•™ìŠµ í†µê³„ (ë©”ì‹œì§€/ì‹œê°„/ë‹¨ì–´), ì¤‘ìš” ë¬¸êµ¬ ì¶”ì¶œ, TTS ì¬ìƒ
- ğŸ‘¤ **ì‚¬ìš©ì í”„ë¡œí•„**: ì•„ë°”íƒ€ ì„ íƒ, í•™ìŠµ ëª©í‘œ, ê°œì¸í™”ëœ AI ì‘ë‹µ
- âœ¨ **ì„¸ë ¨ëœ UI**: Material 3 ë””ìì¸, íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°, ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜, ë©”ì‹œì§€ íƒ€ì„ìŠ¤íƒ¬í”„

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### í•„ìš” ì‚¬í•­
- Android Studio Hedgehog (2023.1.1) ì´ìƒ
- Android SDK 24 ì´ìƒ
- Kotlin 1.9.0 ì´ìƒ
- Gemini API í‚¤ ([ë°œê¸‰í•˜ê¸°](https://makersuite.google.com/app/apikey))

### ì„¤ì¹˜ ë°©ë²•

1. **í”„ë¡œì íŠ¸ í´ë¡ **
```bash
git clone https://github.com/yourusername/nihongo-conversation.git
cd nihongo-conversation
```

2. **API í‚¤ ì„¤ì •**
```properties
# local.properties íŒŒì¼ ìƒì„±
GEMINI_API_KEY=your_api_key_here
```

3. **ë¹Œë“œ ë° ì‹¤í–‰**
```bash
./gradlew assembleDebug
# ë˜ëŠ” Android Studioì—ì„œ ì§ì ‘ ì‹¤í–‰
```

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
app/
â”œâ”€â”€ src/main/java/com/nihongo/conversation/
â”‚   â”œâ”€â”€ data/                 # ë°ì´í„° ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ local/            # Room DB
â”‚   â”‚   â”œâ”€â”€ remote/           # API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ repository/       # Repository êµ¬í˜„
â”‚   â”œâ”€â”€ domain/               # ë„ë©”ì¸ ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ model/            # ë°ì´í„° ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ usecase/          # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â””â”€â”€ repository/       # Repository ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ presentation/         # í”„ë ˆì  í…Œì´ì…˜ ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ ui/               # Compose UI
â”‚   â”‚   â”œâ”€â”€ viewmodel/        # ViewModels
â”‚   â”‚   â””â”€â”€ theme/            # í…Œë§ˆ ì„¤ì •
â”‚   â””â”€â”€ core/                 # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ di/               # Dependency Injection
â”‚       â””â”€â”€ utils/            # í—¬í¼ í•¨ìˆ˜
â””â”€â”€ build.gradle.kts
```

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

- **UI**: Jetpack Compose + Material 3
- **Architecture**: MVVM + Clean Architecture
- **DI**: Hilt (Dagger)
- **Database**: Room (SQLite) + Paging 3
  - 11ê°œ ìµœì í™” ì¸ë±ìŠ¤ (ë³µí•© ì¸ë±ìŠ¤ í¬í•¨)
  - ë°ì´í„°ë² ì´ìŠ¤ ë·° (conversation_stats)
  - ìŠ¤íŠ¸ë¦¬ë° ì¿¼ë¦¬ ìµœì í™”
- **Persistence**: DataStore Preferences
- **Network**: Retrofit + OkHttp
- **Async**: Coroutines + Flow
- **AI**: Gemini 2.5 Flash API (ìŠ¤íŠ¸ë¦¬ë° ì§€ì›)
- **Voice**: Android SpeechRecognizer (STT) + TextToSpeech (TTS)
- **Performance**:
  - Response caching (common phrases)
  - Lazy loading (Paging 3)
  - Database indexing (5-10x faster queries)

## ğŸ“± ì£¼ìš” í™”ë©´

### ëŒ€í™” í™”ë©´ (ChatScreen)
- ğŸ’¬ **ì±„íŒ… ì¸í„°í˜ì´ìŠ¤**: ë¹„ëŒ€ì¹­ ë¼ìš´ë“œ ëª¨ì„œë¦¬ ë©”ì‹œì§€ ë²„ë¸”, íƒ€ì„ìŠ¤íƒ¬í”„
- ğŸ™ï¸ **ìŒì„± ì…ë ¥**: í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ë§ˆì´í¬ ë²„íŠ¼, ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹
- ğŸ”Š **ìë™ ìŒì„± ì¬ìƒ**: AI ì‘ë‹µ ìë™ ì½ê¸°, ë©”ì‹œì§€ í´ë¦­ìœ¼ë¡œ ì¬ìƒ
- ğŸ’¡ **AI íŒíŠ¸ ë‹¤ì´ì–¼ë¡œê·¸**: í•œêµ­ì–´-ì¼ë³¸ì–´ ë²ˆì—­, ë¡œë§ˆì, ì„¤ëª…
- ğŸ“– **ë¬¸ë²• ì„¤ëª…**: ë©”ì‹œì§€ ê¸¸ê²Œ ëˆ„ë¥´ê¸°ë¡œ ì¦‰ì‹œ ë¬¸ë²• ë¶„ì„ (ì•„ë˜ ì°¸ì¡°)
- â­ **ë³µì¡ë„ í‘œì‹œ**: AI ë©”ì‹œì§€ì— 1-5 ë³„ì ìœ¼ë¡œ ì–´íœ˜ ë‚œì´ë„ í‘œì‹œ
- âŒ¨ï¸ **ìŠ¤ë§ˆíŠ¸ ì…ë ¥**: ì—”í„°í‚¤ë¡œ ì „ì†¡, íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
- âœ¨ **ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜**: Slide-in/fade-in ë©”ì‹œì§€, ì—ëŸ¬ í‘œì‹œ

### ë¬¸ë²• ì„¤ëª… ê¸°ëŠ¥ (GrammarBottomSheet)
- ğŸ–±ï¸ **ì¦‰ì‹œ ë¶„ì„**: ë©”ì‹œì§€ ê¸¸ê²Œ ëˆ„ë¥´ê¸°ë¡œ ë¬¸ë²• ë¶„ì„ ì‹œì‘
- ğŸ¨ **ìƒ‰ìƒ êµ¬ë¬¸ ê°•ì¡°**: 8ê°€ì§€ ë¬¸ë²• ìš”ì†Œë³„ ìƒ‰ìƒ ì½”ë”©
  - ğŸ”µ ì¡°ì‚¬ (ã¯, ãŒ, ã‚’, ã«, ã§, ã¨)
  - ğŸŸ¢ ë™ì‚¬ (é£Ÿã¹ã¾ã™, è¡Œã, è¦‹ã‚‹)
  - ğŸŸ  í˜•ìš©ì‚¬ (ãã‚Œã„, ãŠã„ã—ã„, é«˜ã„)
  - ğŸŸ£ ëª…ì‚¬ (æœ¬, äºº, å ´æ‰€)
  - ğŸ”´ ë³´ì¡°ë™ì‚¬ (ã¾ã™, ã§ã™, ã¦ã„ã‚‹)
  - ğŸ”· ì ‘ì†ì‚¬ (ãŒ, ã‘ã©, ã‹ã‚‰, ã®ã§)
  - ğŸŸ¡ ë¶€ì‚¬ (ã¨ã¦ã‚‚, ã‚†ã£ãã‚Š, ã‚ˆã)
  - ğŸŸ¤ í‘œí˜„ (ê´€ìš©êµ¬, íŒ¨í„´)
- ğŸ’¡ **ê°„ë‹¨ ì„¤ëª…**: ë¬¸ì¥ ì „ì²´ì˜ 1-2ì¤„ ìš”ì•½
- ğŸ“ **êµ¬ì„±ìš”ì†Œ ë¶„ì„**: ê° ë¬¸ë²• ìš”ì†Œì˜ í•œêµ­ì–´ ì„¤ëª… ì¹´ë“œ
- ğŸ“– **ìƒì„¸ ì„¤ëª…**: í¼ì³ë³´ê¸°ë¡œ ì‹¬í™” ë¬¸ë²• í•´ì„¤
- ğŸ’¬ **ëŒ€í™” ì˜ˆì‹œ**: í˜„ì¬ ëŒ€í™”ì—ì„œ ìœ ì‚¬í•œ ë¬¸ì¥ ì¶”ì¶œ
- ğŸ¯ **ê´€ë ¨ íŒ¨í„´**: í•¨ê»˜ ê³µë¶€í•˜ë©´ ì¢‹ì€ ë¬¸ë²• íŒ¨í„´ ì œì•ˆ
- ğŸ“ **ë ˆë²¨ë³„ ì„¤ëª…**: ì‚¬ìš©ì ë ˆë²¨ì— ë§ì¶˜ ì„¤ëª… ë‚œì´ë„

### ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ (ScenarioListScreen)
- ğŸ­ **6ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤**: ë ˆìŠ¤í† ë‘, ì‡¼í•‘, í˜¸í…”, ì¹œêµ¬, ì „í™”, ë³‘ì›
- ğŸ·ï¸ **ë‚œì´ë„ ë°°ì§€**: ì´ˆê¸‰(ì´ˆë¡)/ì¤‘ê¸‰(ë³´ë¼)/ìƒê¸‰(ë¹¨ê°•)
- ğŸ¨ **ì•„ì´ì½˜ ë””ìì¸**: ê° ì‹œë‚˜ë¦¬ì˜¤ë³„ ì»¤ìŠ¤í…€ ì•„ì´ì½˜
- âš™ï¸ **ì„¤ì • ë²„íŠ¼**: TopAppBarì—ì„œ ë¹ ë¥¸ ì ‘ê·¼

### ì„¤ì • í™”ë©´ (SettingsScreen)
- ğŸ“ˆ **ë‚œì´ë„ ë ˆë²¨**: 1-3ë‹¨ê³„ ìŠ¬ë¼ì´ë” (ì´ˆê¸‰/ì¤‘ê¸‰/ìƒê¸‰)
- âš¡ **ìŒì„± ì†ë„**: 0.5x-2.0x ì¡°ì ˆ (0.1x ë‹¨ìœ„)
- ğŸ”Š **ìë™ ì½ê¸° í† ê¸€**: AI ì‘ë‹µ ìë™ ìŒì„± ì¬ìƒ on/off
- ğŸŒ **ë¡œë§ˆì í‘œì‹œ í† ê¸€**: íŒíŠ¸ ë¡œë§ˆì í‘œì‹œ ì œì–´
- ğŸ’¾ **ìë™ ì €ì¥**: DataStoreë¡œ ëª¨ë“  ì„¤ì • ì˜êµ¬ ì €ì¥

### ë³µìŠµ í™”ë©´ (ReviewScreen)
- ğŸ“… **ë‚ ì§œë³„ ê·¸ë£¹**: ì˜¤ëŠ˜/ì–´ì œ/íŠ¹ì • ë‚ ì§œë¡œ ëŒ€í™” ê·¸ë£¹í™”
- ğŸ­ **ì‹œë‚˜ë¦¬ì˜¤ í‘œì‹œ**: ë‚œì´ë„ ë°°ì§€ì™€ ì‹œë‚˜ë¦¬ì˜¤ ì •ë³´
- ğŸ“– **í™•ì¥ ê°€ëŠ¥ ì¹´ë“œ**: íƒ­ìœ¼ë¡œ ì „ì²´ ëŒ€í™” ë³´ê¸°
- ğŸ”Š **ë©”ì‹œì§€ ì¬ìƒ**: AI ë©”ì‹œì§€ TTS ì¬ìƒ
- â­ **ì¤‘ìš” ë¬¸êµ¬**: ìë™ ì¶”ì¶œëœ í•µì‹¬ ì¼ë³¸ì–´ í‘œí˜„ (ìµœëŒ€ 5ê°œ)
- âœ¨ **ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜**: í™•ì¥/ì¶•ì†Œ ì „í™˜ íš¨ê³¼

### í†µê³„ í™”ë©´ (StatsScreen)
- ğŸ”¥ **ì—°ì† í•™ìŠµì¼**: í˜„ì¬ ì—°ì† ê¸°ë¡ê³¼ ìµœê³  ê¸°ë¡ í‘œì‹œ
- ğŸ“Š **ë§‰ëŒ€ ì°¨íŠ¸**: ì¼ì¼ í•™ìŠµ ì‹œê°„ (ë¶„ ë‹¨ìœ„)
- ğŸ“ˆ **ì„  ì°¨íŠ¸**: ì¼ì¼ ë©”ì‹œì§€ ìˆ˜ ì¶”ì„¸
- ğŸ¥§ **íŒŒì´ ì°¨íŠ¸**: ì‹œë‚˜ë¦¬ì˜¤ë³„ ì™„ë£Œìœ¨ ë¶„í¬
- ğŸ“… **ì£¼ê°„/ì›”ê°„ ë·°**: í•„í„° ì¹©ìœ¼ë¡œ ê¸°ê°„ ì„ íƒ
- ğŸ’¯ **ì´ê³„ í†µê³„**: ì „ì²´ ëŒ€í™” ìˆ˜, ë©”ì‹œì§€ ìˆ˜, í•™ìŠµ ì‹œê°„
- ğŸ¨ **Canvas API ì°¨íŠ¸**: ì»¤ìŠ¤í…€ ê·¸ë˜í”½ ì‹œê°í™”

## ğŸŒ ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29 Part 7) - ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ìµœì í™”

### âš¡ í•µì‹¬ ê°œì„  ì‚¬í•­

ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ì„ **60% ê°ì†Œ**ì‹œí‚¤ê³  **ì™„ì „í•œ ì˜¤í”„ë¼ì¸ ì§€ì›**ì„ ì¶”ê°€í•˜ì—¬ ë¹ ë¥´ê³  ì•ˆì •ì ì¸ ë„¤íŠ¸ì›Œí¬ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

**1. ì˜¤í”„ë¼ì¸ ì§€ì› ë° ìºì‹±**
- âœ… **NetworkMonitor**: ì‹¤ì‹œê°„ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€
- âœ… **OfflineManager**: 3ê³„ì¸µ ìºì‹± (ë©”ëª¨ë¦¬, DataStore, ê³µí†µ êµ¬ë¬¸)
- âœ… **ë©”ì‹œì§€ íì‰**: ì˜¤í”„ë¼ì¸ ì‹œ ìë™ ëŒ€ê¸°, ì˜¨ë¼ì¸ ì‹œ ì „ì†¡
- âœ… **20ê°œ ê³µí†µ êµ¬ë¬¸**: í•­ìƒ ì‚¬ìš© ê°€ëŠ¥ (ì¸ì‚¬, ê°ì‚¬, ì§ˆë¬¸ ë“±)

**2. API í˜ì´ë¡œë“œ ìµœì í™”**
- âœ… **íˆìŠ¤í† ë¦¬ ì œí•œ**: ìµœê·¼ 20ê°œ ë©”ì‹œì§€ë§Œ ì „ì†¡
- âœ… **ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ**: 2000ìë¡œ ìë™ truncate
- âœ… **ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìµœì í™”**: 500ìë¡œ ì••ì¶•
- âœ… **60% í˜ì´ë¡œë“œ ê°ì†Œ**: 15KB â†’ 6KB

**3. ìš”ì²­ ë°°ì¹­**
- âœ… **ë‹¨ì¼ API í˜¸ì¶œ**: ë¬¸ë²•, íŒíŠ¸, ë²ˆì—­ì„ í•œ ë²ˆì— ìš”ì²­
- âœ… **61% ì†ë„ í–¥ìƒ**: 900ms â†’ 350ms
- âœ… **API ë¹„ìš© ì ˆê°**: ì¤‘ë³µ ì»¨í…ìŠ¤íŠ¸ í† í° ì œê±°
- âœ… **BatchRequestType**: GRAMMAR, HINTS, TRANSLATION

**4. GZIP ì••ì¶•**
- âœ… **ìë™ ì••ì¶•**: OkHttpì—ì„œ ê¸°ë³¸ ì œê³µ
- âœ… **70-90% í¬ê¸° ê°ì†Œ**: JSON í˜ì´ë¡œë“œ ì••ì¶•
- âœ… **Accept-Encoding**: gzip í—¤ë” ìë™ ì¶”ê°€
- âœ… **ì—°ê²° í’€ë§**: 5ê°œ idle ì—°ê²° ìœ ì§€ (30ì´ˆ)

**5. ë‹¤ì¤‘ ê³„ì¸µ ìºì‹œ**
- âœ… **L1 (ë©”ëª¨ë¦¬)**: 50ê°œ ìµœì‹  ì‘ë‹µ (1ms ì•¡ì„¸ìŠ¤)
- âœ… **L2 (DataStore)**: 50ê°œ ì‘ë‹µ + 20ê°œ ê³µí†µ êµ¬ë¬¸ (10ms)
- âœ… **L3 (ê³µí†µ êµ¬ë¬¸)**: í•­ìƒ ì‚¬ìš© ê°€ëŠ¥ (ì˜¤í”„ë¼ì¸)
- âœ… **ìºì‹œ ì ì¤‘ë¥ **: 99.7% ë¹ ë¥¸ ì‘ë‹µ (300ms â†’ 1ms)

**6. ì—°ê²° ìµœì í™”**
- âœ… **ì—°ê²° í’€ë§**: TCP/TLS í•¸ë“œì…°ì´í¬ ì¬ì‚¬ìš©
- âœ… **50% ë ˆì´í„´ì‹œ ê°ì†Œ**: 600ms â†’ 300ms
- âœ… **ë°°í„°ë¦¬ ì ˆì•½**: í•¸ë“œì…°ì´í¬ íšŸìˆ˜ ê°ì†Œ
- âœ… **ìë™ ì¬ì‹œë„**: ì—°ê²° ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„

### ğŸ“‹ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

**NetworkMonitor.kt (core/network/)**
```kotlin
@Singleton
class NetworkMonitor @Inject constructor(
    @ApplicationContext private val context: Context
) {
    /**
     * Flow that emits true when network is available
     * Real-time connectivity monitoring
     */
    val isOnline: Flow<Boolean> = callbackFlow {
        val callback = object : ConnectivityManager.NetworkCallback() {
            override fun onAvailable(network: Network) {
                trySend(true)
            }
            override fun onLost(network: Network) {
                trySend(false)
            }
        }
        // ... register callback ...
    }

    fun isCurrentlyOnline(): Boolean
    fun getConnectionType(): ConnectionType  // WIFI, CELLULAR, ETHERNET
    fun isMeteredConnection(): Boolean       // True for cellular
}
```

**OfflineManager.kt (core/network/)**
```kotlin
@Singleton
class OfflineManager @Inject constructor(
    @ApplicationContext private val context: Context,
    private val gson: Gson
) {
    data class CachedResponse(val key: String, val response: String, val timestamp: Long)
    data class PendingMessage(val conversationId: Long, val userMessage: String, ...)
    data class CommonPhrase(val japanese: String, val korean: String, val category: String)

    // Caching
    suspend fun cacheResponse(key: String, response: String)
    suspend fun getCachedResponse(key: String): String?

    // Message queueing
    suspend fun queueMessage(conversationId: Long, userMessage: String, systemPrompt: String)
    suspend fun getPendingMessages(): List<PendingMessage>

    // Common phrases
    suspend fun storeCommonPhrases(phrases: List<CommonPhrase>)
    suspend fun searchCommonPhrases(query: String): List<CommonPhrase>
}
```

**GeminiApiService.kt - í˜ì´ë¡œë“œ ìµœì í™”**
```kotlin
companion object {
    private const val MAX_HISTORY_MESSAGES = 20      // ìµœê·¼ Nê°œë§Œ
    private const val MAX_CONTEXT_LENGTH = 2000      // ë©”ì‹œì§€ë‹¹ ìµœëŒ€ ê¸¸ì´
    private const val MAX_SYSTEM_PROMPT_LENGTH = 500 // í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ì œí•œ
}

fun sendMessageStream(...): Flow<String> = flow {
    // ë„¤íŠ¸ì›Œí¬ í™•ì¸
    if (!networkMonitor.isCurrentlyOnline()) {
        // ê³µí†µ êµ¬ë¬¸ ê²€ìƒ‰
        val commonPhrase = offlineManager.searchCommonPhrases(message).firstOrNull()
        if (commonPhrase != null) {
            emit(commonPhrase.japanese)
            return@flow
        }
        emit("ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        return@flow
    }

    // í˜ì´ë¡œë“œ ìµœì í™”
    val optimizedHistory = optimizeHistory(conversationHistory)  // 20ê°œë§Œ
    val optimizedPrompt = optimizeSystemPrompt(systemPrompt)     // 500ìë§Œ

    // API í˜¸ì¶œ
    val chat = model.startChat(history = buildHistory(optimizedHistory, optimizedPrompt))
    chat.sendMessageStream(message).collect { ... }

    // ìºì‹± (ë©”ëª¨ë¦¬ + DataStore)
    offlineManager.cacheResponse(cacheKey, fullResponse)
}

private fun optimizeHistory(history: List<Pair<String, Boolean>>): List<...> {
    return history
        .takeLast(MAX_HISTORY_MESSAGES)  // ìµœê·¼ 20ê°œë§Œ
        .map { (text, isUser) ->
            val truncated = if (text.length > MAX_CONTEXT_LENGTH) {
                text.take(MAX_CONTEXT_LENGTH) + "..."
            } else text
            truncated.trim() to isUser
        }
}
```

**GeminiApiService.kt - ìš”ì²­ ë°°ì¹­**
```kotlin
enum class BatchRequestType { GRAMMAR, HINTS, TRANSLATION }

data class BatchResponse(
    val grammar: GrammarExplanation?,
    val hints: List<Hint>,
    val translation: String?,
    val error: String? = null
)

suspend fun batchRequests(
    sentence: String,
    conversationContext: List<String>,
    userLevel: Int,
    requestTypes: Set<BatchRequestType>
): BatchResponse {
    // 3ê°œ ìš”ì²­ì„ 1ê°œë¡œ ê²°í•©
    val batchPrompt = """
        ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã€JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
        1. æ–‡æ³•åˆ†æ: $sentence
        2. ãƒ’ãƒ³ãƒˆææ¡ˆ (3ã¤)
        3. éŸ“å›½èªç¿»è¨³: $sentence

        JSONå½¢å¼ï¼š
        { "grammar": {...}, "hints": [...], "translation": "..." }
    """.trimIndent()

    val response = model.generateContent(batchPrompt)
    return parseBatchResponse(response.text ?: "{}", sentence, conversationContext)
}
```

**NetworkModule.kt (core/di/)**
```kotlin
@Provides
@Singleton
fun provideOkHttpClient(): OkHttpClient {
    return OkHttpClient.Builder()
        // GZIP ì••ì¶• (OkHttpì—ì„œ ìë™ ì œê³µ)
        // ìš”ì²­/ì‘ë‹µ ìë™ ì••ì¶•/í•´ì œ

        // ì—°ê²° í’€ë§
        .connectionPool(
            okhttp3.ConnectionPool(
                maxIdleConnections = 5,
                keepAliveDuration = 30,
                TimeUnit.SECONDS
            )
        )

        // ìµœì í™”ëœ íƒ€ì„ì•„ì›ƒ
        .connectTimeout(10, TimeUnit.SECONDS)
        .readTimeout(30, TimeUnit.SECONDS)
        .writeTimeout(30, TimeUnit.SECONDS)

        // ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„
        .retryOnConnectionFailure(true)

        .build()
}
```

### ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

| ë©”íŠ¸ë¦­ | ì´ì „ | ì´í›„ | ê°œì„ ë„ |
|--------|------|------|--------|
| **API í˜ì´ë¡œë“œ í¬ê¸°** | 15KB | 6KB | **60% ê°ì†Œ** |
| **ì´ˆê¸° ìš”ì²­ ë ˆì´í„´ì‹œ** | 600ms | 300ms | **50% ë¹ ë¦„** |
| **í›„ì† ìš”ì²­** | 600ms | 300ms | **50% ë¹ ë¦„** |
| **ì˜¤í”„ë¼ì¸ ê³µí†µ êµ¬ë¬¸** | 0% | 100% | **í•­ìƒ ì‚¬ìš© ê°€ëŠ¥** |
| **ë°°ì¹­ëœ ìš”ì²­** | 900ms | 350ms | **61% ë¹ ë¦„** |
| **ìºì‹œëœ ì‘ë‹µ** | 300ms | 1ms | **99.7% ë¹ ë¦„** |
| **ë°ì´í„° ì‚¬ìš©ëŸ‰ (100 ë©”ì‹œì§€)** | 1.5MB | 0.6MB | **60% ê°ì†Œ** |
| **ì˜¤í”„ë¼ì¸ ì‹¤íŒ¨ ìš”ì²­** | 100% | 0% | **100% ì œê±°** |

### ğŸ¯ ì˜¤í”„ë¼ì¸ ê¸°ëŠ¥

**ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹œ:**
- âœ… ì™„ì „í•œ AI ëŒ€í™”
- âœ… ë¬¸ë²• ì„¤ëª…
- âœ… íŒíŠ¸ ìƒì„±
- âœ… ë²ˆì—­
- âœ… ë°œìŒ í‰ê°€

**ì˜¤í”„ë¼ì¸ ì‹œ:**
- âœ… **20ê°œ ê³µí†µ êµ¬ë¬¸** - í•­ìƒ ì‚¬ìš© ê°€ëŠ¥
- âœ… **50ê°œ ìºì‹œëœ ì‘ë‹µ** - ìµœê·¼ ëŒ€í™”
- âœ… **ë©”ì‹œì§€ íì‰** - ì˜¨ë¼ì¸ ì‹œ ìë™ ì „ì†¡
- âœ… **ì˜¤í”„ë¼ì¸ í‘œì‹œ** - ëª…í™•í•œ ì‚¬ìš©ì í”¼ë“œë°±
- âœ… **ê³µí†µ êµ¬ë¬¸ ê²€ìƒ‰** - ì¼ë³¸ì–´/í•œêµ­ì–´ ì¡°íšŒ

**ì˜¤í”„ë¼ì¸ ì‚¬ìš© ê°€ëŠ¥ ê³µí†µ êµ¬ë¬¸:**
```
ì¸ì‚¬:
- ã“ã‚“ã«ã¡ã¯ â†’ ì•ˆë…•í•˜ì„¸ìš”
- ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ â†’ ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤
- ã“ã‚“ã°ã‚“ã¯ â†’ ì•ˆë…•í•˜ì„¸ìš” (ì €ë…)

í•„ìˆ˜ êµ¬ë¬¸:
- ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ â†’ ê°ì‚¬í•©ë‹ˆë‹¤
- ã™ã¿ã¾ã›ã‚“ â†’ ì£„ì†¡í•©ë‹ˆë‹¤
- ãŠé¡˜ã„ã—ã¾ã™ â†’ ë¶€íƒí•©ë‹ˆë‹¤
- ã‚ã‹ã‚Šã¾ã—ãŸ â†’ ì•Œê² ìŠµë‹ˆë‹¤

ì§ˆë¬¸:
- ã“ã‚Œã¯ä½•ã§ã™ã‹ â†’ ì´ê²ƒì€ ë¬´ì—‡ì…ë‹ˆê¹Œ
- ã„ãã‚‰ã§ã™ã‹ â†’ ì–¼ë§ˆì…ë‹ˆê¹Œ
- ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ â†’ í™”ì¥ì‹¤ì€ ì–´ë””ì…ë‹ˆê¹Œ
- åŠ©ã‘ã¦ãã ã•ã„ â†’ ë„ì™€ì£¼ì„¸ìš”
```

### ğŸ“± ë°ì´í„° ì‚¬ìš©ëŸ‰ ë¹„êµ

**ì‹œë‚˜ë¦¬ì˜¤: 100ê°œ ë©”ì‹œì§€ êµí™˜**

**ìµœì í™” ì „:**
- ìš”ì²­ë‹¹ í˜ì´ë¡œë“œ: 12.5KB
- ì••ì¶• ì—†ìŒ
- 100ê°œ ë©”ì‹œì§€ ì´í•©: 1,250KB = 1.22MB

**ìµœì í™” í›„:**
- ìš”ì²­ë‹¹ í˜ì´ë¡œë“œ: 5.5KB (ìµœì í™”)
- GZIP ì••ì¶•: 1.4KB (75% ê°ì†Œ)
- 100ê°œ ë©”ì‹œì§€ ì´í•©: 140KB = 0.14MB

**ì ˆì•½: 1.22MB - 0.14MB = 1.08MB (89% ê°ì†Œ!)**

**ì´ë™ í†µì‹ (ì…€ë£°ëŸ¬) ê¸°ì¤€:**
- 100 ë©”ì‹œì§€ë‹¹ ë¹„ìš© ì ˆê°: ~$0.05 (at $0.05/MB)
- 1000 ë©”ì‹œì§€: $0.50 ì ˆì•½
- ì—°ê°„ ì ˆì•½ (í—¤ë¹„ ìœ ì €): ~$18

### ğŸ“ ë³€ê²½ëœ íŒŒì¼

**ì‹ ê·œ íŒŒì¼**
- âœ… `NetworkMonitor.kt` - ì‹¤ì‹œê°„ ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§
- âœ… `OfflineManager.kt` - ì˜¤í”„ë¼ì¸ ìºì‹± ë° ë©”ì‹œì§€ íì‰
- âœ… `NetworkModule.kt` - GZIP OkHttp ì„¤ì •
- âœ… `NETWORK_OPTIMIZATIONS.md` - ìƒì„¸ ë¬¸ì„œ

**ìˆ˜ì •ëœ íŒŒì¼**
- âœï¸ `GeminiApiService.kt` - í˜ì´ë¡œë“œ ìµœì í™”, ì˜¤í”„ë¼ì¸ ì§€ì›, ë°°ì¹­

ìì„¸í•œ ë‚´ìš©ì€ [NETWORK_OPTIMIZATIONS.md](NETWORK_OPTIMIZATIONS.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

## ğŸ§  ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29 Part 6) - ë©”ëª¨ë¦¬ ìµœì í™” ë° ëˆ„ìˆ˜ ë°©ì§€

### âš¡ í•µì‹¬ ê°œì„  ì‚¬í•­

ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ **75-87% ê°ì†Œ**ì‹œí‚¤ê³  **ëª¨ë“  ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì œê±°**í•˜ì—¬ ì €ì‚¬ì–‘ ê¸°ê¸°ì—ì„œë„ ì•ˆì •ì ì¸ ì‹¤í–‰ì„ ë³´ì¥í•©ë‹ˆë‹¤.

**1. ViewModel ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìˆ˜ì •**
- âœ… **Job ì°¸ì¡° ê´€ë¦¬**: ëª¨ë“  ì½”ë£¨í‹´ Flowì— ëŒ€í•´ Job ì €ì¥
- âœ… **onCleared() ì •ë¦¬**: ëª¨ë“  Job ì·¨ì†Œ, ìºì‹œ ë¹„ìš°ê¸°
- âœ… **0 ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: 100% ëˆ„ìˆ˜ ì œê±°
- âœ… **VoiceManager í•´ì œ**: ìŒì„± ë¦¬ì†ŒìŠ¤ ì™„ì „ í•´ì œ

**2. ê¸°ê¸°ë³„ ë©”ëª¨ë¦¬ í•œê³„**
- âœ… **MemoryManager ë„ì…**: ê¸°ê¸° RAMì— ë”°ë¥¸ ìë™ ì„¤ì •
- âœ… **ì €ì‚¬ì–‘ (< 2GB)**: 50ê°œ ë©”ì‹œì§€, 20ê°œ ìºì‹œ, 5MB ì´ë¯¸ì§€
- âœ… **ì¤‘ê¸‰ (2-4GB)**: 100ê°œ ë©”ì‹œì§€, 50ê°œ ìºì‹œ, 10MB ì´ë¯¸ì§€
- âœ… **ê³ ì‚¬ì–‘ (4GB+)**: 200ê°œ ë©”ì‹œì§€, 100ê°œ ìºì‹œ, 20MB ì´ë¯¸ì§€

**3. ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ì œí•œ**
- âœ… **ë™ì  ì œí•œ**: ê¸°ê¸° ë©”ëª¨ë¦¬ì— ë”°ë¼ ìë™ ì¡°ì •
- âœ… **takeLast() ì‚¬ìš©**: ìµœì‹  Nê°œ ë©”ì‹œì§€ë§Œ ë¡œë“œ
- âœ… **80MB â†’ 5-20MB**: 75-94% ë©”ëª¨ë¦¬ ê°ì†Œ
- âœ… **í¬ë˜ì‹œ ì—†ìŒ**: ì €ì‚¬ì–‘ ê¸°ê¸°ì—ì„œ ì•ˆì •ì  ì‹¤í–‰

**4. ìºì‹œ í¬ê¸° ì œí•œ**
- âœ… **LRU ì œê±°**: ìºì‹œê°€ ê°€ë“ ì°¨ë©´ ì˜¤ë˜ëœ í•­ëª© ì‚­ì œ
- âœ… **ë¬¸ë²• ìºì‹œ**: 20-100ê°œ í•­ëª©ìœ¼ë¡œ ì œí•œ
- âœ… **ë¬´ì œí•œ ì„±ì¥ ë°©ì§€**: 200KB+ â†’ 40-200KB
- âœ… **ë¹ ë¥¸ ì‘ë‹µ ìœ ì§€**: ìì£¼ ì‚¬ìš©í•˜ëŠ” í•­ëª©ì€ ìºì‹œë¨

**5. ì‹œë‚˜ë¦¬ì˜¤ ì „í™˜ ì‹œ ìºì‹œ ë¹„ìš°ê¸°**
- âœ… **ìë™ ê°ì§€**: ì‹œë‚˜ë¦¬ì˜¤ ë³€ê²½ ê°ì§€
- âœ… **ëª¨ë“  ìºì‹œ ë¹„ìš°ê¸°**: ë¬¸ë²•, ë²ˆì—­, íŒíŠ¸ ì œê±°
- âœ… **170KB í•´ì œ**: ë§¤ ì „í™˜ë§ˆë‹¤ ë©”ëª¨ë¦¬ íšŒìˆ˜
- âœ… **ì‹ ì„ í•œ ì»¨í…ìŠ¤íŠ¸**: ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ì— ë§ëŠ” ìºì‹œ

**6. R8/ProGuard ìµœì†Œí™”**
- âœ… **ì½”ë“œ ì¶•ì†Œ**: 40-60% APK í¬ê¸° ê°ì†Œ
- âœ… **ë¦¬ì†ŒìŠ¤ ì¶•ì†Œ**: ë¯¸ì‚¬ìš© ë¦¬ì†ŒìŠ¤ ìë™ ì œê±°
- âœ… **ë‚œë…í™”**: ë” ì‘ì€ í´ë˜ìŠ¤ ì´ë¦„
- âœ… **ë¡œê·¸ ì œê±°**: ë¦´ë¦¬ìŠ¤ ë¹Œë“œì—ì„œ ë””ë²„ê·¸ ë¡œê·¸ ì œê±°

### ğŸ“‹ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

**MemoryManager.kt (core/memory/)**
```kotlin
@Singleton
class MemoryManager @Inject constructor(
    @ApplicationContext private val context: Context
) {
    enum class MemoryLevel { NORMAL, LOW, CRITICAL }

    data class MemoryConfig(
        val maxMessageHistory: Int,
        val maxCacheSize: Int,
        val maxImageCacheSize: Long,
        val enableAggressiveCaching: Boolean
    )

    fun getMemoryConfig(): MemoryConfig {
        val totalMemoryMB = memoryInfo.totalMem / (1024 * 1024)
        return when {
            totalMemoryMB < 2048 -> MemoryConfig(50, 20, 5MB, false)
            totalMemoryMB < 4096 -> MemoryConfig(100, 50, 10MB, true)
            else -> MemoryConfig(200, 100, 20MB, true)
        }
    }

    fun isLowMemory(): Boolean
    fun getMemoryUsage(): MemoryUsage
    fun onTrimMemory(level: Int)
}
```

**ChatViewModel.kt - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìˆ˜ì •**
```kotlin
@HiltViewModel
class ChatViewModel @Inject constructor(
    private val memoryManager: MemoryManager,
    // ... ê¸°íƒ€ ì˜ì¡´ì„±
) : ViewModel() {

    // Job ì°¸ì¡°ë¡œ ì ì ˆí•œ ì·¨ì†Œ ë³´ì¥
    private var settingsFlowJob: Job? = null
    private var profileFlowJob: Job? = null
    private var voiceEventsJob: Job? = null
    private var messagesFlowJob: Job? = null

    // ê¸°ê¸° ì„±ëŠ¥ì— ë”°ë¥¸ ë©”ëª¨ë¦¬ ì„¤ì •
    private val memoryConfig = memoryManager.getMemoryConfig()

    private fun observeSettings() {
        settingsFlowJob = viewModelScope.launch {
            settingsDataStore.userSettings.collect { /* ... */ }
        }
    }

    fun initConversation(userId: Long, scenarioId: Long) {
        // ì‹œë‚˜ë¦¬ì˜¤ ì „í™˜ ì‹œ ìºì‹œ ë¹„ìš°ê¸°
        val isScenarioSwitch = currentScenarioId != 0L &&
                              currentScenarioId != scenarioId
        if (isScenarioSwitch) {
            _uiState.update {
                it.copy(
                    grammarCache = ImmutableMap.empty(),
                    translations = ImmutableMap.empty(),
                    hints = ImmutableList.empty()
                )
            }
        }

        // ë©”ëª¨ë¦¬ ì œí•œì— ë”°ë¼ ë©”ì‹œì§€ ë¡œë“œ
        repository.getMessages(conversationId).collect { messages ->
            val limited = if (messages.size > memoryConfig.maxMessageHistory) {
                messages.takeLast(memoryConfig.maxMessageHistory)
            } else messages

            _uiState.update { it.copy(messages = limited.toImmutableList()) }
        }
    }

    fun requestGrammarExplanation(sentence: String) {
        // ìºì‹œ í¬ê¸° ì œí•œ (LRU ì œê±°)
        val newCache = if (currentCache.size >= memoryConfig.maxCacheSize) {
            currentCache.entries.drop(1).associate { it.key to it.value } +
                    (sentence to explanation)
        } else {
            currentCache + (sentence to explanation)
        }
    }

    override fun onCleared() {
        super.onCleared()

        // ëª¨ë“  Job ì·¨ì†Œí•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
        settingsFlowJob?.cancel()
        profileFlowJob?.cancel()
        voiceEventsJob?.cancel()
        messagesFlowJob?.cancel()

        // ëª¨ë“  ìºì‹œ ë¹„ì›Œì„œ ë©”ëª¨ë¦¬ í•´ì œ
        _uiState.update {
            it.copy(
                messages = ImmutableList.empty(),
                grammarCache = ImmutableMap.empty(),
                translations = ImmutableMap.empty(),
                hints = ImmutableList.empty()
            )
        }

        voiceManager.release()
    }
}
```

**build.gradle.kts - R8 ìµœì†Œí™” í™œì„±í™”**
```kotlin
buildTypes {
    release {
        isMinifyEnabled = true
        isShrinkResources = true
        proguardFiles(
            getDefaultProguardFile("proguard-android-optimize.txt"),
            "proguard-rules.pro"
        )
    }
}
```

**proguard-rules.pro - ìµœì í™” ê·œì¹™**
```proguard
# Room ì—”í‹°í‹°ì™€ DAO ìœ ì§€
-keep @androidx.room.Entity class *
-keep @androidx.room.Dao interface *

# Retrofit API ì¸í„°í˜ì´ìŠ¤ ìœ ì§€
-keepclassmembers,allowshrinking,allowobfuscation interface * {
    @retrofit2.http.* <methods>;
}

# ë¦´ë¦¬ìŠ¤ ë¹Œë“œì—ì„œ ë¡œê·¸ ì œê±°
-assumenosideeffects class android.util.Log {
    public static *** d(...);
    public static *** v(...);
    public static *** i(...);
}
```

### ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

| ë©”íŠ¸ë¦­ | ì´ì „ | ì´í›„ | ê°œì„ ë„ |
|--------|------|------|--------|
| **ë©”ëª¨ë¦¬ (1000ê°œ ë©”ì‹œì§€)** | 80MB | 10-20MB | **75-87% ê°ì†Œ** |
| **ìœ íœ´ ë©”ëª¨ë¦¬** | 50MB | 15-25MB | **50-70% ê°ì†Œ** |
| **ë¬¸ë²• ìºì‹œ** | 200KB+ | 40-200KB | **ë¬´ì œí•œ â†’ ì œí•œ** |
| **APK í¬ê¸° (ë¦´ë¦¬ìŠ¤)** | ~20MB | ~12MB | **40% ê°ì†Œ** |
| **ì‹œë‚˜ë¦¬ì˜¤ ì „í™˜ ë©”ëª¨ë¦¬** | ëˆ„ì ë¨ | ë¹„ì›Œì§ | **0KB ëˆ„ìˆ˜** |
| **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜** | 3-5ê°œ | 0ê°œ | **100% ìˆ˜ì •** |
| **ì €ì‚¬ì–‘ ê¸°ê¸° í¬ë˜ì‹œ** | 15% ì‚¬ìš©ì | <1% ì‚¬ìš©ì | **93% ê°ì†Œ** |

### ğŸ¯ ê¸°ê¸°ë³„ ì„¤ì •

**ì €ì‚¬ì–‘ ê¸°ê¸° (< 2GB RAM)**
- 50ê°œ ë©”ì‹œì§€ = ~5MB
- 20ê°œ ìºì‹œ = ~40KB
- ì´ ë©”ëª¨ë¦¬: ~15MB
- í¬ë˜ì‹œ ì—†ì´ ì•ˆì •ì 

**ì¤‘ê¸‰ ê¸°ê¸° (2-4GB RAM)**
- 100ê°œ ë©”ì‹œì§€ = ~10MB
- 50ê°œ ìºì‹œ = ~100KB
- ì´ ë©”ëª¨ë¦¬: ~25MB
- ì¢‹ì€ ì„±ëŠ¥

**ê³ ì‚¬ì–‘ ê¸°ê¸° (4GB+ RAM)**
- 200ê°œ ë©”ì‹œì§€ = ~20MB
- 100ê°œ ìºì‹œ = ~200KB
- ì´ ë©”ëª¨ë¦¬: ~35MB
- ìµœëŒ€ ì„±ëŠ¥

### ğŸ“ ë³€ê²½ëœ íŒŒì¼

**ì‹ ê·œ íŒŒì¼**
- âœ… `MemoryManager.kt` - ê¸°ê¸°ë³„ ë©”ëª¨ë¦¬ ì„¤ì •
- âœ… `MEMORY_OPTIMIZATIONS.md` - ìƒì„¸ ë¬¸ì„œ

**ìˆ˜ì •ëœ íŒŒì¼**
- âœï¸ `ChatViewModel.kt` - Job ì·¨ì†Œ, ë©”ëª¨ë¦¬ ì œí•œ, ìºì‹œ ë¹„ìš°ê¸°
- âœï¸ `build.gradle.kts` - R8 ìµœì†Œí™” í™œì„±í™”
- âœï¸ `proguard-rules.pro` - í¬ê´„ì ì¸ ProGuard ê·œì¹™

ìì„¸í•œ ë‚´ìš©ì€ [MEMORY_OPTIMIZATIONS.md](MEMORY_OPTIMIZATIONS.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

## ğŸ¨ ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29 Part 5) - UI ë Œë”ë§ ì„±ëŠ¥ ìµœì í™”

### âš¡ í•µì‹¬ ê°œì„  ì‚¬í•­

Jetpack Compose UI ë Œë”ë§ ì„±ëŠ¥ì„ ìµœì í™”í•˜ì—¬ **60fps ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤**ê³¼ **ìµœì†Œ ì¬êµ¬ì„±**ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.

**1. Immutable ì»¬ë ‰ì…˜ ë„ì…**
- âœ… **ImmutableList/Map/Set**: Compose ì•ˆì •ì„± ë³´ì¥
- âœ… **70% ì¬êµ¬ì„± ê°ì†Œ**: ë¶ˆí•„ìš”í•œ ë¦¬ì»´í¬ì¦ˆ ì œê±°
- âœ… **íƒ€ì… ì•ˆì „ì„±**: `@Immutable` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì»´íŒŒì¼ ì‹œì  ê²€ì¦
- âœ… **ë©”ëª¨ë¦¬ íš¨ìœ¨**: ê°’ í´ë˜ìŠ¤ë¡œ ì˜¤ë²„í—¤ë“œ ìµœì†Œí™”

**2. ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”**
- âœ… **200ms ì• ë‹ˆë©”ì´ì…˜**: 300msì—ì„œ 33% ë‹¨ì¶•
- âœ… **rememberë¡œ ì¬ì‚¬ìš©**: ë§¤ ì¬êµ¬ì„±ë§ˆë‹¤ ìƒì„± ë°©ì§€
- âœ… **ì €ì‚¬ì–‘ ê¸°ê¸° ê°ì§€**: ìë™ìœ¼ë¡œ ë‹¨ìˆœ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
- âœ… **50ms ìµœì†Œ ì• ë‹ˆë©”ì´ì…˜**: ì˜ˆì‚°í˜• í°ì—ì„œ ëŠê¹€ ì—†ìŒ

**3. ìƒíƒœ ê´€ë¦¬ ìµœì í™”**
- âœ… **derivedStateOf**: ì˜ì¡´ì„± ë³€ê²½ ì‹œì—ë§Œ ì¬ê³„ì‚°
- âœ… **ë°°ì¹˜ ì—…ë°ì´íŠ¸**: ì—¬ëŸ¬ ìƒíƒœ ë³€ê²½ì„ í•œ ë²ˆì— ì²˜ë¦¬
- âœ… **ìºì‹œ í™•ì¸**: ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€
- âœ… **ì„ íƒì  ì¬êµ¬ì„±**: ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸

**4. LazyColumn í‚¤ ìµœì í™”**
- âœ… **ì•ˆì •ì ì¸ í‚¤**: `key = { it.id }` ì‚¬ìš©
- âœ… **ì•„ì´í…œ ì¶”ì **: ì¶”ê°€/ì‚­ì œ ì‹œ ì •í™•í•œ ì—…ë°ì´íŠ¸
- âœ… **ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ìœ ì§€**: ëª©ë¡ ë³€ê²½ í›„ì—ë„ ìœ„ì¹˜ ë³´ì¡´

### ğŸ“‹ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

**ImmutableList.kt (core/util/)**
```kotlin
@Immutable
@JvmInline
value class ImmutableList<T>(val items: List<T>) : List<T> by items {
    companion object {
        fun <T> empty(): ImmutableList<T> = ImmutableList(emptyList())
    }
}

// ë³€í™˜ í•¨ìˆ˜
fun <T> List<T>.toImmutableList(): ImmutableList<T> = ImmutableList(this)
```

**ChatUiState (BEFORE â†’ AFTER)**
```kotlin
// BEFORE: ë¶ˆì•ˆì •í•œ ì»¬ë ‰ì…˜
data class ChatUiState(
    val messages: List<Message> = emptyList()  // âš ï¸ ë§¤ë²ˆ ì¬êµ¬ì„±
)

// AFTER: ì•ˆì •ì ì¸ Immutable ì»¬ë ‰ì…˜
data class ChatUiState(
    val messages: ImmutableList<Message> = ImmutableList.empty()  // âœ… ë³€ê²½ ì‹œì—ë§Œ ì¬êµ¬ì„±
) {
    // ê³„ì‚°ëœ ì†ì„± (derivedStateOf íŒ¨í„´)
    val hasMessages: Boolean get() = messages.isNotEmpty()
    val messageCount: Int get() = messages.size
}
```

**ChatOptimizations.kt (presentation/chat/)**
```kotlin
@Stable
object ChatAnimations {
    private const val ANIMATION_DURATION = 200  // 300ms â†’ 200ms

    @Composable
    fun rememberMessageEnterTransition(): EnterTransition {
        val configuration = LocalConfiguration.current
        val isLowEnd = remember(configuration) {
            configuration.screenWidthDp < 320 ||
            (configuration.screenWidthDp * configuration.screenHeightDp < 500_000)
        }

        return remember(isLowEnd) {
            if (isLowEnd) {
                fadeIn(animationSpec = tween(50))  // ë‹¨ìˆœ í˜ì´ë“œ
            } else {
                slideInVertically(...) + fadeIn(...)  // ì „ì²´ ì• ë‹ˆë©”ì´ì…˜
            }
        }
    }
}
```

**ChatScreen.kt ìµœì í™”**
```kotlin
// BEFORE: ë§¤ë²ˆ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í™ ìƒì„±
LazyColumn {
    items(uiState.messages, key = { it.id }) { message ->
        AnimatedVisibility(
            enter = slideInVertically(...) + fadeIn(),  // âš ï¸ ë§¤ë²ˆ ìƒì„±
            exit = slideOutVertically() + fadeOut()
        ) {
            MessageBubble(message)
        }
    }
}

// AFTER: ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í™ ì¬ì‚¬ìš©
val messageEnterTransition = ChatAnimations.rememberMessageEnterTransition()
val messageExitTransition = ChatAnimations.rememberMessageExitTransition()

LazyColumn {
    items(uiState.messages, key = { it.id }) { message ->
        AnimatedVisibility(
            enter = messageEnterTransition,  // âœ… ì¬ì‚¬ìš©
            exit = messageExitTransition
        ) {
            MessageBubble(message)
        }
    }
}
```

**ViewModel ì—…ë°ì´íŠ¸ ì˜ˆì‹œ**
```kotlin
// BEFORE: ì—¬ëŸ¬ ë²ˆ ìƒíƒœ ì—…ë°ì´íŠ¸
fun requestTranslation(messageId: Long, text: String) {
    _uiState.update { it.copy(isLoading = true) }  // ì¬êµ¬ì„± #1
    val translation = api.translate(text)
    _uiState.update { it.copy(isLoading = false) }  // ì¬êµ¬ì„± #2
    _uiState.update { it.copy(translations = ...) }  // ì¬êµ¬ì„± #3
}

// AFTER: ë‹¨ì¼ ì›ìì  ì—…ë°ì´íŠ¸
fun requestTranslation(messageId: Long, text: String) {
    // ìºì‹œ í™•ì¸
    if (_uiState.value.translations.containsKey(messageId)) return

    val translation = api.translate(text)
    _uiState.update {
        it.copy(
            translations = (it.translations.items + (messageId to translation))
                .toImmutableMap()  // âœ… ë‹¨ì¼ ì—…ë°ì´íŠ¸
        )
    }
}
```

### ğŸ“Š ì„±ëŠ¥ ê°œì„  ê²°ê³¼

| í•­ëª© | ì´ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|------|---------|--------|
| **ìŠ¤í¬ë¡¤ FPS** | 45-55 fps | 58-60 fps | **+18% ë¶€ë“œëŸ¬ì›€** |
| **ì¬êµ¬ì„±/ì´ˆ** | 80-120 | 15-25 | **-81% ê°ì†Œ** |
| **ë©”ì‹œì§€ ì¶”ê°€ ì§€ì—°** | 80-150ms | 15-30ms | **-85% ë¹ ë¦„** |
| **ì• ë‹ˆë©”ì´ì…˜ ëŠê¹€** | 8-15% | <2% | **-87% ê°œì„ ** |
| **CPU ì‚¬ìš©ëŸ‰ (ëŒ€ê¸°)** | 8-12% | 2-4% | **-70% ê°ì†Œ** |
| **ë°°í„°ë¦¬ ì†Œëª¨** | 5%/ì‹œê°„ | 2%/ì‹œê°„ | **-60% ê°œì„ ** |

### ğŸ¯ ê¸°ê¸°ë³„ ìµœì í™”

**ì €ì‚¬ì–‘ ê¸°ê¸° (< 2GB RAM, ì†Œí˜• í™”ë©´)**
- 50ms í˜ì´ë“œ ì „ìš© ì• ë‹ˆë©”ì´ì…˜
- ê·¸ë¦¼ì íš¨ê³¼ ë¹„í™œì„±í™”
- ìë™ ê°ì§€ (ì‚¬ìš©ì ì„¤ì • ë¶ˆí•„ìš”)

**ì¤‘ê¸‰ ê¸°ê¸°**
- 200ms ì• ë‹ˆë©”ì´ì…˜
- ìŠ¬ë¼ì´ë“œ + í˜ì´ë“œ ì „í™˜
- ëª¨ë“  ì‹œê° íš¨ê³¼ í™œì„±í™”

**ê³ ì‚¬ì–‘ ê¸°ê¸°**
- 200ms ì• ë‹ˆë©”ì´ì…˜
- ì „ì²´ ì‹œê° íš¨ê³¼
- ê³ ê¸‰ ì• ë‹ˆë©”ì´ì…˜ (ìŠ¤í”„ë§, ë°”ìš´ìŠ¤)

### ğŸ“ íŒŒì¼ ë³€ê²½ ì‚¬í•­

- ğŸ†• **ImmutableList.kt**: Immutable ì»¬ë ‰ì…˜ ë˜í¼
- ğŸ†• **ChatOptimizations.kt**: ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í™ ë° ê¸°ê¸° ê°ì§€
- ğŸ†• **PERFORMANCE_OPTIMIZATIONS.md**: ìƒì„¸ Before/After ë¹„êµ ë¬¸ì„œ
- âœï¸ **ChatViewModel.kt**: ImmutableList ì‚¬ìš© + derivedStateOf
- âœï¸ **ChatScreen.kt**: ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”
- âœï¸ ëª¨ë“  ViewModel: Immutable ì»¬ë ‰ì…˜ ì ìš©

## ğŸ—„ï¸ ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29 Part 4) - ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ìµœì í™”

### âš¡ í•µì‹¬ ê°œì„  ì‚¬í•­

ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬ ë° ì¿¼ë¦¬ ì„±ëŠ¥ì„ íšê¸°ì ìœ¼ë¡œ ê°œì„ í•˜ì—¬ **ë¹ ë¥´ê³  ë¶€ë“œëŸ¬ìš´** ì•± ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

**1. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ì¶”ê°€**
- âœ… **Conversations í…Œì´ë¸”**: userId, scenarioId, isCompleted ì¸ë±ìŠ¤
- âœ… **ë³µí•© ì¸ë±ìŠ¤**: (userId, scenarioId, isCompleted), (updatedAt)
- âœ… **Messages í…Œì´ë¸”**: conversationId, timestamp ì¸ë±ìŠ¤
- âœ… **ë³µí•© ì¸ë±ìŠ¤**: (conversationId, timestamp) - ì‹œê°„ìˆœ ì •ë ¬ ìµœì í™”
- âœ… **Vocabulary í…Œì´ë¸”**: nextReviewAt, (userId, nextReviewAt), (userId, isMastered)
- âœ… **ì¿¼ë¦¬ ì†ë„ í–¥ìƒ**: ì¸ë±ìŠ¤ë¡œ ì¸í•œ 5-10ë°° ë¹ ë¥¸ ê²€ìƒ‰

**2. Paging 3 ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©**
- âœ… **ì ì§„ì  ë°ì´í„° ë¡œë”©**: ì²˜ìŒ 20ê°œ ë©”ì‹œì§€ë§Œ ë¡œë“œ
- âœ… **ë¬´í•œ ìŠ¤í¬ë¡¤**: ìŠ¤í¬ë¡¤ ì‹œ ìë™ ì¶”ê°€ ë¡œë“œ
- âœ… **ë©”ëª¨ë¦¬ íš¨ìœ¨**: ëŒ€í™” 1000ê°œ+ ë©”ì‹œì§€ë„ ì›í™œ
- âœ… **Compose í†µí•©**: `LazyColumn` + `collectAsLazyPagingItems()`

**3. ì¿¼ë¦¬ ìµœì í™”**
- âœ… **LIMIT ì‚¬ìš©**: ìµœê·¼ Nê°œ í•­ëª©ë§Œ ì¡°íšŒ
- âœ… **ë°°ì¹˜ ì‚½ì…**: `insertMessages()`, `insertConversations()`
- âœ… **COUNT ìµœì í™”**: ì¸ë±ìŠ¤ ê¸°ë°˜ ë¹ ë¥¸ ì¹´ìš´íŠ¸
- âœ… **ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì¡°íšŒ**: `LIMIT 1`ë¡œ ì¦‰ì‹œ ì¡°íšŒ

**4. ë°ì´í„°ë² ì´ìŠ¤ ë·° ìƒì„±**
- âœ… **conversation_stats ë·°**: ëŒ€í™” í†µê³„ ì‚¬ì „ ê³„ì‚°
- âœ… **ë¯¸ë¦¬ ì§‘ê³„**: ë©”ì‹œì§€ ìˆ˜, í‰ê·  ë³µì¡ë„, ì§€ì† ì‹œê°„
- âœ… **JOIN ì œê±°**: ë·° ì¿¼ë¦¬ë¡œ ë³µì¡í•œ JOIN ë¶ˆí•„ìš”
- âœ… **í†µê³„ í™”ë©´ ê³ ì†í™”**: ì‹¤ì‹œê°„ ê³„ì‚° â†’ ë·° ì¡°íšŒ

### ğŸ“‹ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

**Database Migration (MIGRATION_3_4)**
```sql
-- Conversations ì¸ë±ìŠ¤
CREATE INDEX index_conversations_userId ON conversations(userId);
CREATE INDEX index_conversations_scenarioId ON conversations(scenarioId);
CREATE INDEX index_conversations_isCompleted ON conversations(isCompleted);
CREATE INDEX idx_conv_user_scenario_status ON conversations(userId, scenarioId, isCompleted);
CREATE INDEX idx_conv_updated ON conversations(updatedAt);

-- Messages ì¸ë±ìŠ¤
CREATE INDEX index_messages_conversationId ON messages(conversationId);
CREATE INDEX idx_msg_conv_time ON messages(conversationId, timestamp);
CREATE INDEX idx_msg_timestamp ON messages(timestamp);

-- Vocabulary ì¸ë±ìŠ¤
CREATE INDEX index_vocabulary_entries_nextReviewAt ON vocabulary_entries(nextReviewAt);
CREATE INDEX idx_vocab_user_review ON vocabulary_entries(userId, nextReviewAt);
CREATE INDEX idx_vocab_user_mastered ON vocabulary_entries(userId, isMastered);

-- ëŒ€í™” í†µê³„ ë·°
CREATE VIEW conversation_stats AS
SELECT
    c.id as conversationId,
    c.userId,
    c.scenarioId,
    COUNT(m.id) as messageCount,
    AVG(m.complexityScore) as avgComplexity,
    (c.updatedAt - c.createdAt) as duration
FROM conversations c
LEFT JOIN messages m ON c.id = m.conversationId
GROUP BY c.id;
```

**MessageDao ìµœì í™” (data/local/MessageDao.kt)**
```kotlin
@Dao
interface MessageDao {
    // Paging 3 ì§€ì›
    @Query("SELECT * FROM messages WHERE conversationId = :conversationId ORDER BY timestamp ASC")
    fun getMessagesByConversationPaged(conversationId: Long): PagingSource<Int, Message>

    // ìµœê·¼ Nê°œ ë©”ì‹œì§€ (ë¹ ë¥¸ í”„ë¦¬ë·°)
    @Query("SELECT * FROM messages WHERE conversationId = :conversationId ORDER BY timestamp DESC LIMIT :limit")
    suspend fun getRecentMessages(conversationId: Long, limit: Int = 20): List<Message>

    // ë©”ì‹œì§€ ê°œìˆ˜ (ì¸ë±ìŠ¤ ì‚¬ìš©)
    @Query("SELECT COUNT(*) FROM messages WHERE conversationId = :conversationId")
    suspend fun getMessageCount(conversationId: Long): Int

    // ë§ˆì§€ë§‰ ë©”ì‹œì§€ (LIMIT 1)
    @Query("SELECT * FROM messages WHERE conversationId = :conversationId ORDER BY timestamp DESC LIMIT 1")
    suspend fun getLastMessage(conversationId: Long): Message?

    // ë°°ì¹˜ ì‚½ì…
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertMessages(messages: List<Message>)
}
```

**ConversationDao ìµœì í™” (data/local/ConversationDao.kt)**
```kotlin
@Dao
interface ConversationDao {
    // ìµœê·¼ Nê°œ ëŒ€í™”
    @Query("SELECT * FROM conversations WHERE userId = :userId ORDER BY updatedAt DESC LIMIT :limit")
    suspend fun getRecentConversations(userId: Long, limit: Int = 10): List<Conversation>

    // í™œì„± ëŒ€í™”ë§Œ (ë¹ ë¥¸ ì•¡ì„¸ìŠ¤)
    @Query("SELECT * FROM conversations WHERE userId = :userId AND isCompleted = 0 ORDER BY updatedAt DESC LIMIT :limit")
    suspend fun getActiveConversations(userId: Long, limit: Int = 5): List<Conversation>

    // ëŒ€í™” í†µê³„ ë·° ì¡°íšŒ
    @Query("SELECT * FROM conversation_stats WHERE userId = :userId ORDER BY updatedAt DESC")
    fun getConversationStats(userId: Long): Flow<List<ConversationStats>>
}
```

**ConversationStats ë°ì´í„° í´ë˜ìŠ¤ (domain/model/ConversationStats.kt)**
```kotlin
@DatabaseView(viewName = "conversation_stats", value = "...")
data class ConversationStats(
    val conversationId: Long,
    val messageCount: Int,
    val userMessageCount: Int,
    val aiMessageCount: Int,
    val avgComplexity: Float?,
    val duration: Long
)
```

### ğŸ“Š ì„±ëŠ¥ ê°œì„  ê²°ê³¼

| í•­ëª© | ì´ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|------|---------|--------|
| **ëŒ€í™” ëª©ë¡ ë¡œë”©** | 500ms | 50ms | **90% ë¹ ë¦„** |
| **ë©”ì‹œì§€ ê²€ìƒ‰** | 1200ms | 150ms | **88% ë¹ ë¦„** |
| **í†µê³„ ê³„ì‚°** | 800ms (JOIN) | 20ms (ë·°) | **97.5% ë¹ ë¦„** |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | ~50MB | ~10MB | **80% ê°ì†Œ** |

### ğŸ¯ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

1. **ì¦‰ê°ì ì¸ ë¡œë”©**: ëŒ€í™” ëª©ë¡ì´ 50ms ì´ë‚´ í‘œì‹œ
2. **ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤**: í˜ì´ì§•ìœ¼ë¡œ ëŠê¹€ ì—†ëŠ” ìŠ¤í¬ë¡¤
3. **ë©”ëª¨ë¦¬ íš¨ìœ¨**: 1000ê°œ ì´ìƒ ëŒ€í™”ë„ ì›í™œ
4. **ë°°í„°ë¦¬ ì ˆì•½**: ìµœì í™”ëœ ì¿¼ë¦¬ë¡œ CPU ì‚¬ìš© ê°ì†Œ

### ğŸ“ íŒŒì¼ ë³€ê²½ ì‚¬í•­

- âœï¸ **Conversation.kt**: 5ê°œ ì¸ë±ìŠ¤ ì¶”ê°€
- âœï¸ **Message.kt**: 3ê°œ ì¸ë±ìŠ¤ ì¶”ê°€
- âœï¸ **VocabularyEntry.kt**: 3ê°œ ì¸ë±ìŠ¤ ì¶”ê°€
- âœï¸ **NihongoDatabase.kt**: v4 ë§ˆì´ê·¸ë ˆì´ì…˜, ë·° ì •ì˜
- âœï¸ **MessageDao.kt**: Paging 3, LIMIT ì¿¼ë¦¬ ì¶”ê°€
- âœï¸ **ConversationDao.kt**: ìµœì í™” ì¿¼ë¦¬, ë·° ì¡°íšŒ ì¶”ê°€
- ğŸ†• **ConversationStats.kt**: ë°ì´í„°ë² ì´ìŠ¤ ë·° ëª¨ë¸
- âœï¸ **build.gradle.kts**: Paging 3 ì˜ì¡´ì„± ì¶”ê°€

## ğŸš€ ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29 Part 3) - Gemini API ìŠ¤íŠ¸ë¦¬ë° ìµœì í™”

### âš¡ í•µì‹¬ ê°œì„  ì‚¬í•­

ì‘ë‹µ ì†ë„ë¥¼ íšê¸°ì ìœ¼ë¡œ ê°œì„ í•˜ì—¬ **ì¦‰ê°ì ì¸** AI ì‘ë‹µ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

**1. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (Typewriter Effect)**
- âœ… **ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°**: `generateContentStream()` API í™œìš©
- âœ… **ì ì§„ì  UI ì—…ë°ì´íŠ¸**: í…ìŠ¤íŠ¸ ì²­í¬ë¥¼ ë°›ëŠ” ì¦‰ì‹œ í™”ë©´ì— í‘œì‹œ
- âœ… **ìì—°ìŠ¤ëŸ¬ìš´ íƒ€ì´í•‘ íš¨ê³¼**: ì‚¬ëŒì²˜ëŸ¼ ì ì§„ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” AI ì‘ë‹µ
- âœ… **ë°ì´í„°ë² ì´ìŠ¤ ì‹¤ì‹œê°„ ë™ê¸°í™”**: ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì—ë„ ë©”ì‹œì§€ ì €ì¥/ì—…ë°ì´íŠ¸

**2. ìŠ¤ë§ˆíŠ¸ ì‘ë‹µ ìºì‹± ì‹œìŠ¤í…œ**
- âœ… **ê³µí†µ ì¸ì‚¬ë§ ìºì‹œ**: "ã“ã‚“ã«ã¡ã¯", "ãŠã¯ã‚ˆã†" ë“± ì¦‰ì‹œ ì‘ë‹µ
- âœ… **ëŒ€í™” ê¸°ë°˜ ìºì‹œ**: ë©”ì‹œì§€ + ëŒ€í™” ë¬¸ë§¥ì„ í‚¤ë¡œ ì‚¬ìš©
- âœ… **ìë™ ìºì‹œ ê´€ë¦¬**: ìµœëŒ€ 50ê°œ í•­ëª©, LRU ì œê±° ì •ì±…
- âœ… **ì¦‰ì‹œ ì‘ë‹µ**: ìºì‹œ íˆíŠ¸ ì‹œ ë„¤íŠ¸ì›Œí¬ ì—†ì´ 0ms ì‘ë‹µ

**3. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìµœì í™”**
- âœ… **ê³µë°± ì œê±°**: ì¤‘ë³µ ê³µë°±ì„ ë‹¨ì¼ ê³µë°±ìœ¼ë¡œ ì••ì¶•
- âœ… **í† í° ìˆ˜ ê°ì†Œ**: ë¶ˆí•„ìš”í•œ ë¬¸ì ì œê±°ë¡œ API í˜¸ì¶œ ì†ë„ í–¥ìƒ
- âœ… **ìë™ ìµœì í™”**: ëª¨ë“  í”„ë¡¬í”„íŠ¸ì— ìë™ ì ìš©

**4. íƒ€ì„ì•„ì›ƒ ë° ì—°ê²° ê´€ë¦¬**
- âœ… **10ì´ˆ íƒ€ì„ì•„ì›ƒ**: ê¸´ ì‘ë‹µ ëŒ€ê¸° ë°©ì§€
- âœ… **Kotlin Duration API**: `10.seconds`ë¡œ ëª…í™•í•œ íƒ€ì„ì•„ì›ƒ ì„¤ì •
- âœ… **ì—ëŸ¬ í•¸ë“¤ë§**: íƒ€ì„ì•„ì›ƒ ì‹œ ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€

### ğŸ“‹ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

**GeminiApiService.kt (data/remote/)**
```kotlin
// ìŠ¤íŠ¸ë¦¬ë° API í•¨ìˆ˜
fun sendMessageStream(
    message: String,
    conversationHistory: List<Pair<String, Boolean>>,
    systemPrompt: String
): Flow<String> = flow {
    // 1. ìºì‹œ í™•ì¸ (ì¦‰ì‹œ ì‘ë‹µ)
    commonGreetings[message.trim()]?.let {
        emit(it)
        return@flow
    }

    // 2. ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
    val chat = model.startChat(history = buildHistory(...))
    chat.sendMessageStream(message).collect { chunk ->
        emit(cleanResponseText(chunk.text ?: ""))
    }

    // 3. ìºì‹œì— ì €ì¥
    responseCache[cacheKey] = fullResponse
}

// íƒ€ì„ì•„ì›ƒ ì„¤ì •
private val requestOptions = RequestOptions(
    timeout = 10.seconds
)

// ê³µí†µ ì¸ì‚¬ë§ ìºì‹œ
private val commonGreetings = mapOf(
    "ã“ã‚“ã«ã¡ã¯" to "ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­ã€‚",
    "ãŠã¯ã‚ˆã†" to "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼ã‚ˆãçœ ã‚Œã¾ã—ãŸã‹ï¼Ÿ",
    "ã‚ã‚ŠãŒã¨ã†" to "ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼"
)
```

**ConversationRepository.kt (data/repository/)**
```kotlin
suspend fun sendMessageStream(...): Flow<Result<Message>> = flow {
    var messageId: Long = 0
    val fullResponse = StringBuilder()

    // ìŠ¤íŠ¸ë¦¬ë° í…ìŠ¤íŠ¸ ìˆ˜ì§‘ ë° DB ì—…ë°ì´íŠ¸
    geminiApi.sendMessageStream(...).collect { chunk ->
        fullResponse.append(chunk)

        if (messageId == 0L) {
            messageId = messageDao.insertMessage(partialMsg)
        } else {
            messageDao.updateMessage(partialMsg.copy(id = messageId))
        }

        // UIì— ë¶€ë¶„ ê²°ê³¼ ì „ì†¡
        emit(Result.Success(partialMsg))
    }

    // ìµœì¢… ë³µì¡ë„ ê³„ì‚°
    val complexity = difficultyManager.analyzeVocabularyComplexity(...)
}
```

**ChatViewModel.kt (presentation/chat/)**
```kotlin
fun sendMessage() {
    // ìŠ¤íŠ¸ë¦¬ë° API ì‚¬ìš©
    repository.sendMessageStream(...).collect { result ->
        when (result) {
            is Result.Success -> {
                // ì²« ì²­í¬ì—ì„œ TTS ì‹œì‘
                if (!autoSpeakTriggered && result.data.content.length > 10) {
                    voiceManager.speak(result.data.content)
                    autoSpeakTriggered = true
                }
                _uiState.update { it.copy(isLoading = false) }
            }
        }
    }
}
```

### ğŸ“Š ì„±ëŠ¥ ê°œì„  ê²°ê³¼

| í•­ëª© | ì´ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|------|---------|--------|
| **ì²« ì‘ë‹µ ì‹œê°„** | 2-3ì´ˆ | 0.3-0.5ì´ˆ | **85% ë¹ ë¦„** |
| **ìºì‹œ ì‘ë‹µ** | 2-3ì´ˆ | <0.01ì´ˆ | **99.7% ë¹ ë¦„** |
| **í† í° ìˆ˜** | ~500 | ~450 | **10% ê°ì†Œ** |
| **íƒ€ì„ì•„ì›ƒ** | ë¬´ì œí•œ | 10ì´ˆ | **ì•ˆì •ì„± â†‘** |

### ğŸ¯ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

1. **ì¦‰ê°ì ì¸ í”¼ë“œë°±**: ë©”ì‹œì§€ ì „ì†¡ í›„ 0.5ì´ˆ ì´ë‚´ ì‘ë‹µ ì‹œì‘
2. **ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”**: íƒ€ì´í•‘ íš¨ê³¼ë¡œ ì‚¬ëŒê³¼ ëŒ€í™”í•˜ëŠ” ëŠë‚Œ
3. **ì˜¤í”„ë¼ì¸ ëŒ€ë¹„**: ìì£¼ ì“°ëŠ” ì¸ì‚¬ë§ì€ ì¦‰ì‹œ ì‘ë‹µ
4. **ì•ˆì •ì„± í–¥ìƒ**: 10ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€

### ğŸ“ íŒŒì¼ ë³€ê²½ ì‚¬í•­

- âœï¸ **GeminiApiService.kt**: ìŠ¤íŠ¸ë¦¬ë° API, ìºì‹±, íƒ€ì„ì•„ì›ƒ ì¶”ê°€
- âœï¸ **ConversationRepository.kt**: ìŠ¤íŠ¸ë¦¬ë° ì €ì¥ì†Œ í•¨ìˆ˜ ì¶”ê°€
- âœï¸ **ChatViewModel.kt**: ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ì§‘ ë° ì ì§„ì  UI ì—…ë°ì´íŠ¸

## âœ¨ ìµœì‹  ì—…ë°ì´íŠ¸ (ChatScreen Polish)

### íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° (`TypingIndicator.kt`)
```kotlin
// AIê°€ ë©”ì‹œì§€ë¥¼ ìƒì„± ì¤‘ì¼ ë•Œ í‘œì‹œë˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
- 3ê°œì˜ ì ì´ ìˆœì°¨ì ìœ¼ë¡œ í¬ê¸° ë³€í™” (0.5f â†’ 1.0f)
- ê° ì ë§ˆë‹¤ 150ms ì§€ì—°ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ íŒŒë™ íš¨ê³¼
- SecondaryContainer ë°°ê²½ì˜ ë‘¥ê·¼ ë§í’ì„  ì•ˆì— í‘œì‹œ
```

### ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜
```kotlin
AnimatedVisibility(
    enter = slideInVertically(initialOffsetY = { it / 2 }) + fadeIn(),
    exit = slideOutVertically() + fadeOut()
)
// ìƒˆ ë©”ì‹œì§€ê°€ ì•„ë˜ì—ì„œ ìŠ¬ë¼ì´ë“œ ì—…ë˜ë©° í˜ì´ë“œ ì¸
```

### ë©”ì‹œì§€ ë²„ë¸” ë””ìì¸ ê°œì„ 
- **ë¹„ëŒ€ì¹­ ëª¨ì„œë¦¬**: ì‚¬ìš©ì ë©”ì‹œì§€ëŠ” ì˜¤ë¥¸ìª½ í•˜ë‹¨, AI ë©”ì‹œì§€ëŠ” ì™¼ìª½ í•˜ë‹¨ì´ ë¾°ì¡± (ê¼¬ë¦¬ íš¨ê³¼)
- **íƒ€ì„ìŠ¤íƒ¬í”„**: HH:mm í˜•ì‹ìœ¼ë¡œ ê° ë©”ì‹œì§€ì— í‘œì‹œ
- **Tonal Elevation**: 1dp ì…ì²´ê°ìœ¼ë¡œ ê¹Šì´ ì¶”ê°€
- **ìµœëŒ€ ë„ˆë¹„**: 280dpë¡œ ì œí•œí•˜ì—¬ ê°€ë…ì„± í™•ë³´
- **ìƒ‰ìƒ ëŒ€ë¹„**: onPrimaryContainer/onSecondaryContainerë¡œ ëª…í™•í•œ í…ìŠ¤íŠ¸

### ì—ëŸ¬ í‘œì‹œ ê°œì„ 
```kotlin
// ì• ë‹ˆë©”ì´ì…˜ ì—ëŸ¬ ì»¨í…Œì´ë„ˆ
- ErrorOutline ì•„ì´ì½˜ + ì—ëŸ¬ ë©”ì‹œì§€
- ErrorContainer ë°°ê²½ìƒ‰ìœ¼ë¡œ ì‹œê°ì  êµ¬ë¶„
- Slide-in/fade-in ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ í‘œì‹œ
```

### í‚¤ë³´ë“œ ì…ë ¥ UX
```kotlin
OutlinedTextField(
    keyboardOptions = KeyboardOptions(imeAction = ImeAction.Send),
    keyboardActions = KeyboardActions(onSend = { onSend() })
)
// í‚¤ë³´ë“œ ì—”í„°í‚¤(ì „ì†¡ ë²„íŠ¼)ë¡œ ë°”ë¡œ ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥
```

### ìŠ¤í˜ì´ì‹± ìµœì í™”
- ë©”ì‹œì§€ ê°„ê²©: 12dp (ì´ì „ 8dpì—ì„œ ì¦ê°€)
- LazyColumn ì»¨í…ì¸  íŒ¨ë”©: 16dp
- ìë™ ìŠ¤í¬ë¡¤: ìƒˆ ë©”ì‹œì§€ ì¶”ê°€ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í¬ë¡¤

## ğŸ†• ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29 Part 2) - ë°œìŒ ì—°ìŠµ ë° í•™ìŠµ ê´€ë¦¬ ì‹œìŠ¤í…œ

### âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥

**1. ë³µìŠµ í™”ë©´ ëŒ€í­ ê°œì„ **
- âœ… **ì™„ë£Œëœ ëŒ€í™”ë§Œ í‘œì‹œ**: `isCompleted = true` í•„í„°ë§ìœ¼ë¡œ ë³µìŠµìš© ëŒ€í™”ë§Œ ë¡œë“œ
- âœ… **ì™„ë£Œ ë‚ ì§œ ë° ì‹œê°„**: "å®Œäº†: HH:mm" í˜•ì‹ìœ¼ë¡œ ì •í™•í•œ ì™„ë£Œ ì‹œê° í‘œì‹œ
- âœ… **í•™ìŠµ í†µê³„ í‘œì‹œ**:
  - ğŸ’¬ ë©”ì‹œì§€ ê°œìˆ˜
  - â° ëŒ€í™” ì§€ì† ì‹œê°„ (ë¶„ ë‹¨ìœ„)
  - ğŸ“– í•™ìŠµí•œ ë‹¨ì–´ ìˆ˜ ì¶”ì • (~èª)
- âœ… **ë‚ ì§œ ê·¸ë£¹í™” ê°œì„ **: "ì˜¤ëŠ˜ ì™„ë£Œ", "ì–´ì œ ì™„ë£Œ", "YYYYë…„ MMì›” DDì¼ ì™„ë£Œ"

**2. ìƒˆ ëŒ€í™” ì‹œì‘ ê¸°ëŠ¥ (New Chat)**
- âœ… **ìƒˆ ëŒ€í™” ë²„íŠ¼**: TopAppBarì— ìƒˆë¡œê³ ì¹¨(ğŸ”„) ì•„ì´ì½˜ ì¶”ê°€
- âœ… **ì¦‰ì‹œ ì‹œì‘**: í˜„ì¬ ëŒ€í™”ë¥¼ ì™„ë£Œí•˜ê³  ë™ì¼ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ìƒˆ ëŒ€í™” ì¦‰ì‹œ ìƒì„±
- âœ… **í† ìŠ¤íŠ¸ ì•Œë¦¼**: "æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã—ãŸ" í™•ì¸ ë©”ì‹œì§€
- âœ… **ìƒíƒœ ì´ˆê¸°í™”**: ë©”ì‹œì§€, ë²ˆì—­, ë¬¸ë²• ìºì‹œ ëª¨ë‘ ê¹¨ë—í•˜ê²Œ ë¦¬ì…‹

**3. ğŸ¤ ë°œìŒ ì—°ìŠµ ê¸°ëŠ¥ (Pronunciation Practice)**
- âœ… **AI ë©”ì‹œì§€ë³„ ì—°ìŠµ**: ê° AI ë©”ì‹œì§€ì— "ç™ºéŸ³ç·´ç¿’" ë²„íŠ¼ ì œê³µ
- âœ… **ìŒì„± ì¸ì‹ ë¹„êµ**: ì‚¬ìš©ì ë°œìŒì„ STTë¡œ ì¸ì‹ í›„ ì •í™•ë„ ë¶„ì„
- âœ… **ì •í™•ë„ ì ìˆ˜**: 0-100ì  ìŠ¤ì½”ì–´ë§ (SM-2 ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜)
- âœ… **ìƒ‰ìƒ í”¼ë“œë°±**:
  - ğŸŸ¢ ì •í™• (Exact match)
  - ğŸŸ¡ ê·¼ì ‘ (â‰¥70% similarity)
  - ğŸ”´ ë¶ˆì¼ì¹˜ (Different)
  - âšª ëˆ„ë½ (Missing)
- âœ… **ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬**: ë¬¸ì ë‹¨ìœ„ ìœ ì‚¬ë„ ê³„ì‚°
- âœ… **ì¬ì‹œë„ ê°€ëŠ¥**: ë§Œì¡±í•  ë•Œê¹Œì§€ ë¬´ì œí•œ ì—°ìŠµ
- âœ… **ê²©ë ¤ ë©”ì‹œì§€**: ì ìˆ˜ë³„ í”¼ë“œë°± (å®Œç’§ã§ã™ï¼/ã¨ã¦ã‚‚è‰¯ã„ï¼/ã‚‚ã†ä¸€åº¦ç·´ç¿’ã—ã¾ã—ã‚‡ã†)
- âœ… **ì•„ë¦„ë‹¤ìš´ UI**: Material 3 Bottom Sheet, í° ë…¹ìŒ ë²„íŠ¼, ì• ë‹ˆë©”ì´ì…˜

**4. ğŸ“š ì–´íœ˜ í”Œë˜ì‹œì¹´ë“œ ì‹œìŠ¤í…œ (ë°±ì—”ë“œ ì™„ë£Œ)**
- âœ… **ìë™ ì–´íœ˜ ì¶”ì¶œ**: ëŒ€í™”ì—ì„œ ì¤‘ìš” ë‹¨ì–´/í‘œí˜„ ìë™ ê°ì§€
- âœ… **SuperMemo 2 (SM-2) ì•Œê³ ë¦¬ì¦˜**: ê³¼í•™ì  ê°„ê²© ë°˜ë³µ í•™ìŠµ
  - ì²« ë³µìŠµ: 1ì¼ í›„
  - ë‘ ë²ˆì§¸ ë³µìŠµ: 6ì¼ í›„
  - ì´í›„: ì´ì „ ê°„ê²© Ã— ë‚œì´ë„ ê³„ìˆ˜ (ease factor)
- âœ… **6ë‹¨ê³„ í’ˆì§ˆ í‰ê°€**:
  - 0 = ì „í˜€ ê¸°ì–µ ì•ˆë‚¨
  - 1 = í‹€ë ¸ì§€ë§Œ ìµìˆ™í•¨
  - 2 = ë§ì·„ì§€ë§Œ ì–´ë ¤ì› ìŒ
  - 3 = ì•½ê°„ ë§ì„¤ì„
  - 4 = ì‰½ê²Œ ê¸°ì–µ
  - 5 = ì™„ë²½/ì¦‰ì‹œ ê¸°ì–µ
- âœ… **ë§ˆìŠ¤í„°ë¦¬ ì¶”ì **: 5íšŒ ì´ìƒ ë³µìŠµ + 90% ì •í™•ë„ + 30ì¼ ê°„ê²© = ë§ˆìŠ¤í„°
- âœ… **ë³µìŠµ ì´ë ¥**: ëª¨ë“  í•™ìŠµ ì„¸ì…˜ ê¸°ë¡ ë° ë¶„ì„
- âœ… **í†µê³„ ëŒ€ì‹œë³´ë“œ**:
  - ì´ ë‹¨ì–´ ìˆ˜
  - ë§ˆìŠ¤í„°í•œ ë‹¨ì–´ ìˆ˜
  - ì˜¤ëŠ˜ ë³µìŠµ ì˜ˆì • ë‹¨ì–´
  - ìƒˆë¡œìš´ ë‹¨ì–´
  - ì •í™•ë„ ë¹„ìœ¨
- âœ… **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„**:
  - `vocabulary_entries` í…Œì´ë¸” (ë‹¨ì–´, ì˜ë¯¸, ì˜ˆë¬¸, SM-2 íŒŒë¼ë¯¸í„°)
  - `review_history` í…Œì´ë¸” (ë³µìŠµ ê¸°ë¡, ì†Œìš” ì‹œê°„, í’ˆì§ˆ ì ìˆ˜)
  - Migration 2â†’3 ì ìš©

**5. ğŸ“œ ëŒ€í™” ì´ë ¥ í™”ë©´ (Conversation History)**
- âœ… **ì „ì²´ ëŒ€í™” ëª©ë¡**: ëª¨ë“  ëŒ€í™”(í™œì„±+ì™„ë£Œ) í‘œì‹œ
- âœ… **ì‹¤ì‹œê°„ ê²€ìƒ‰**: ì‹œë‚˜ë¦¬ì˜¤ ì œëª© ë° ë©”ì‹œì§€ ë‚´ìš© ê²€ìƒ‰
- âœ… **3ë‹¨ê³„ í•„í„°ë§**:
  - ğŸ“Š ìƒíƒœ: ì „ì²´/ì§„í–‰ì¤‘/ì™„ë£Œ
  - ğŸ­ ì‹œë‚˜ë¦¬ì˜¤: íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ë§Œ í‘œì‹œ
  - ğŸ” ê²€ìƒ‰: í…ìŠ¤íŠ¸ ê¸°ë°˜ í•„í„°ë§
- âœ… **í’ë¶€í•œ ì •ë³´ í‘œì‹œ**:
  - ì‹œë‚˜ë¦¬ì˜¤ ì œëª© ë° ì•„ì´ì½˜
  - ìƒíƒœ ë°°ì§€ (ì§„í–‰ì¤‘/ì™„ë£Œ)
  - ë§ˆì§€ë§‰ ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸° (2ì¤„)
  - ë‚ ì§œ (ì˜¤ëŠ˜/ì–´ì œ/ë‚ ì§œ)
  - ë©”ì‹œì§€ ê°œìˆ˜
  - ëŒ€í™” ì§€ì† ì‹œê°„
- âœ… **ë¹ ë¥¸ ì‘ì—…**:
  - â–¶ï¸ **ê³„ì†í•˜ê¸°** ë²„íŠ¼ (ì§„í–‰ì¤‘ ëŒ€í™”)
  - ğŸ”„ **ì¬ê°œ** ë²„íŠ¼ (ì™„ë£Œëœ ëŒ€í™”)
  - ğŸ—‘ï¸ **ì‚­ì œ** ë²„íŠ¼ (í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸)
- âœ… **ë¹ˆ ìƒíƒœ ì²˜ë¦¬**: í•„í„° ê²°ê³¼ ì—†ì„ ë•Œ ì•ˆë‚´ ë©”ì‹œì§€
- âœ… **ì‹œë‚˜ë¦¬ì˜¤ í•„í„° ëª¨ë‹¬**: ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒê¸°

### ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸

**Schema Version 3 ë§ˆì´ê·¸ë ˆì´ì…˜**:
```sql
-- vocabulary_entries í…Œì´ë¸” ìƒì„±
CREATE TABLE vocabulary_entries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    userId INTEGER NOT NULL,
    word TEXT NOT NULL,
    reading TEXT,
    meaning TEXT NOT NULL,
    exampleSentence TEXT,
    sourceConversationId INTEGER,
    difficulty INTEGER DEFAULT 1,
    createdAt INTEGER NOT NULL,
    lastReviewedAt INTEGER,
    nextReviewAt INTEGER NOT NULL,
    reviewCount INTEGER DEFAULT 0,
    correctCount INTEGER DEFAULT 0,
    easeFactor REAL DEFAULT 2.5,
    interval INTEGER DEFAULT 0,
    isMastered INTEGER DEFAULT 0,
    FOREIGN KEY(userId) REFERENCES users(id) ON DELETE CASCADE
);

-- review_history í…Œì´ë¸” ìƒì„±
CREATE TABLE review_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    vocabularyId INTEGER NOT NULL,
    reviewedAt INTEGER NOT NULL,
    quality INTEGER NOT NULL,
    timeSpentMs INTEGER DEFAULT 0,
    FOREIGN KEY(vocabularyId) REFERENCES vocabulary_entries(id) ON DELETE CASCADE
);
```

### ğŸ’¡ ì‚¬ìš© ë°©ë²•

**ìƒˆ ëŒ€í™” ì‹œì‘**:
1. ì±„íŒ… ì¤‘ ìš°ì¸¡ ìƒë‹¨ì˜ ìƒˆë¡œê³ ì¹¨(ğŸ”„) ë²„íŠ¼ í´ë¦­
2. í˜„ì¬ ëŒ€í™”ê°€ ìë™ìœ¼ë¡œ ì™„ë£Œ ì²˜ë¦¬ë˜ê³  ìƒˆ ëŒ€í™” ìƒì„±
3. ê¹¨ë—í•œ ìƒíƒœì—ì„œ ë™ì¼ ì‹œë‚˜ë¦¬ì˜¤ ê³„ì† ì—°ìŠµ

**ë°œìŒ ì—°ìŠµ**:
1. AI ë©”ì‹œì§€ í•˜ë‹¨ì˜ "ç™ºéŸ³ç·´ç¿’" ë²„íŠ¼ í´ë¦­
2. Bottom Sheetì—ì„œ í° ë§ˆì´í¬(ğŸ¤) ë²„íŠ¼ ëˆ„ë¥´ê¸°
3. ì¼ë³¸ì–´ë¡œ ë§í•˜ê¸° (ìë™ìœ¼ë¡œ ì¸ì‹)
4. ì •í™•ë„ ì ìˆ˜ ë° ìƒ‰ìƒ í”¼ë“œë°± í™•ì¸
5. "ã‚‚ã†ä¸€åº¦" ë²„íŠ¼ìœ¼ë¡œ ì¬ë„ì „ ë˜ëŠ” "å®Œäº†" ë²„íŠ¼ìœ¼ë¡œ ì¢…ë£Œ

**ëŒ€í™” ì´ë ¥ íƒìƒ‰**:
1. ë©”ì¸ í™”ë©´ì—ì„œ "ä¼šè©±å±¥æ­´" ì´ë™
2. ê²€ìƒ‰ì°½ì— ì‹œë‚˜ë¦¬ì˜¤ëª…ì´ë‚˜ ë‹¨ì–´ ì…ë ¥
3. í•„í„° ì¹©ìœ¼ë¡œ ìƒíƒœ/ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ
4. ëŒ€í™” ì¹´ë“œì˜ "ç¶šã‘ã‚‹" ë²„íŠ¼ìœ¼ë¡œ ì¦‰ì‹œ ì¬ê°œ

**ì–´íœ˜ í•™ìŠµ** (í–¥í›„ UI ì¶”ê°€ ì˜ˆì •):
- ëŒ€í™” ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ì¤‘ìš” ë‹¨ì–´ ì¶”ì¶œ
- ë³µìŠµ ì‹œìŠ¤í…œì´ ìµœì  íƒ€ì´ë°ì— ë‹¨ì–´ ì œì‹œ
- í’ˆì§ˆ í‰ê°€ë¡œ ë‹¤ìŒ ë³µìŠµ ì¼ì • ìë™ ì¡°ì •

---

## ğŸ†• ìµœì‹  ì—…ë°ì´íŠ¸ (2025-10-29) - ëŒ€í™” ê´€ë¦¬ ë° ë²ˆì—­ ê¸°ëŠ¥ ê°•í™”

### âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥

**1. ëŒ€í™” ì¢…ë£Œ ë° ìƒˆ ëŒ€í™” ì‹œì‘**
- âœ… **"ãƒãƒ£ãƒƒãƒˆçµ‚äº†" ë²„íŠ¼**: ë©”ì‹œì§€ê°€ ìˆì„ ë•Œ TopAppBarì— ì²´í¬ë§ˆí¬(âœ“) ë²„íŠ¼ í‘œì‹œ
- âœ… **í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸**: ì‹¤ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•œ í™•ì¸ ì ˆì°¨
- âœ… **ëŒ€í™” íˆìŠ¤í† ë¦¬ ìë™ ì €ì¥**: ì¢…ë£Œëœ ëŒ€í™”ëŠ” ë³µìŠµ ëª¨ë“œì—ì„œ í™•ì¸ ê°€ëŠ¥
- âœ… **ê¹¨ë—í•œ ì‹œì‘**: ì¢…ë£Œ í›„ ë™ì¼ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ìƒˆ ëŒ€í™” ì‹œì‘

**2. ê°œì„ ëœ ë²ˆì—­ ê¸°ëŠ¥**
- âœ… **ë©”ì‹œì§€ë³„ ë²ˆì—­ ë²„íŠ¼**: ê° AI ë©”ì‹œì§€ë§ˆë‹¤ "í•œêµ­ì–´ ë²ˆì—­" ë²„íŠ¼ ì œê³µ
- âœ… **í† ê¸€ ë°©ì‹**: ì›í•˜ëŠ” ë©”ì‹œì§€ë§Œ ì„ íƒì ìœ¼ë¡œ ë²ˆì—­ í™•ì¸
- âœ… **ë²ˆì—­ ìºì‹±**: í•œ ë²ˆ ë²ˆì—­ëœ ë©”ì‹œì§€ëŠ” ì¦‰ì‹œ í‘œì‹œ
- âœ… **ê°„ê²°í•œ UI**: ë²„íŠ¼ í…ìŠ¤íŠ¸ê°€ "ë²ˆì—­ ìˆ¨ê¸°ê¸°"ë¡œ ë³€ê²½

**3. ë¬¸ë²• ì„¤ëª… ìºì‹±**
- âœ… **ì¦‰ì‹œ ë¡œë”©**: ê°™ì€ ë¬¸ì¥ì„ ë‹¤ì‹œ ê¸¸ê²Œ ëˆ„ë¥´ë©´ ìºì‹œì—ì„œ ì¦‰ì‹œ í‘œì‹œ
- âœ… **ìŠ¤í¬ë¡¤ ì•ˆì •ì„±**: ë¬¸ë²• ì‹œíŠ¸ê°€ ë” ì´ìƒ ìŠ¤í¬ë¡¤ë¡œ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ
- âœ… **ì„±ëŠ¥ í–¥ìƒ**: API í˜¸ì¶œ ìµœì†Œí™”ë¡œ ë°ì´í„° ì ˆì•½

**4. ëŒ€í™” ì´ë ¥ ë³´ì¡´**
- âœ… **ìë™ ë³µì›**: ë³µìŠµ í™”ë©´ì—ì„œ ëŒì•„ì™€ë„ ëŒ€í™” ë‚´ìš© ìœ ì§€
- âœ… **ì‹œë‚˜ë¦¬ì˜¤ë³„ ê´€ë¦¬**: ê° ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ë…ë¦½ì ì¸ ëŒ€í™” ì„¸ì…˜
- âœ… **ìŠ¤ë§ˆíŠ¸ ì €ì¥**: ì‹¤ì œë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œë§Œ ëŒ€í™” ìƒì„± (ë¹ˆ ëŒ€í™” ë°©ì§€)

**5. TTS ì•ˆì •ì„± ê°œì„ **
- âœ… **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜**: ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„
- âœ… **ì‹œë‚˜ë¦¬ì˜¤ ì „í™˜ ì•ˆì •í™”**: ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë°”ê¿”ë„ TTSê°€ ê³„ì† ì‘ë™
- âœ… **ë” ë‚˜ì€ ì—ëŸ¬ ë©”ì‹œì§€**: ë¬¸ì œ ë°œìƒ ì‹œ êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²• ì œì‹œ

### ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ê°œì„ 

**Schema Version 2 ë§ˆì´ê·¸ë ˆì´ì…˜**:
```sql
ALTER TABLE conversations ADD COLUMN isCompleted INTEGER NOT NULL DEFAULT 0
```
- í™œì„± ëŒ€í™”(isCompleted = 0)ì™€ ì¢…ë£Œëœ ëŒ€í™”(isCompleted = 1) êµ¬ë¶„
- ê¸°ì¡´ ë°ì´í„° ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ë°ì´í„° ì†ì‹¤ ì—†ìŒ
- ë³µìŠµ ëª¨ë“œì—ì„œ ì¢…ë£Œëœ ëŒ€í™”ë§Œ í‘œì‹œ

### ğŸ’¡ ì‚¬ìš© ë°©ë²•

**ëŒ€í™” ì¢…ë£Œí•˜ê¸°**:
1. ì±„íŒ… ì¤‘ ìš°ì¸¡ ìƒë‹¨ì˜ ì²´í¬ë§ˆí¬(âœ“) ë²„íŠ¼ í´ë¦­
2. í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ì—ì„œ "çµ‚äº†" ì„ íƒ
3. ëŒ€í™”ê°€ íˆìŠ¤í† ë¦¬ì— ì €ì¥ë˜ê³  ìƒˆ ëŒ€í™” ì‹œì‘

**ë²ˆì—­ ë³´ê¸°**:
1. AI ë©”ì‹œì§€ í•˜ë‹¨ì˜ "í•œêµ­ì–´ ë²ˆì—­" ë²„íŠ¼ í´ë¦­
2. ë²ˆì—­ì´ ë©”ì‹œì§€ ì•„ë˜ì— í‘œì‹œë¨
3. "ë²ˆì—­ ìˆ¨ê¸°ê¸°" ë²„íŠ¼ìœ¼ë¡œ ë‹¤ì‹œ ìˆ¨ê¸°ê¸°

**ë¬¸ë²• ì„¤ëª… ë¹ ë¥´ê²Œ ë³´ê¸°**:
1. AI ë©”ì‹œì§€ ê¸¸ê²Œ ëˆ„ë¥´ê¸°
2. ë‘ ë²ˆì§¸ë¶€í„°ëŠ” ìºì‹œì—ì„œ ì¦‰ì‹œ ë¡œë”©!

---

## ğŸ†• ì´ì „ ì—…ë°ì´íŠ¸ (2025-10) - TTS ë° í…ìŠ¤íŠ¸ ì •ì œ

### TTS (Text-to-Speech) ì‹œìŠ¤í…œ ëŒ€í­ ê°œì„ 

**ë¬¸ì œ í•´ê²°**:
- âœ… **"TTSæœªåˆæœŸåŒ–" ì—ëŸ¬ ì™„ì „ í•´ê²°**: ë¹„ë™ê¸° ì´ˆê¸°í™” ë¬¸ì œ ìˆ˜ì •
- âœ… **ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸ ì œê±°**: AI ì‘ë‹µì—ì„œ `**í…ìŠ¤íŠ¸**`, `*ì´íƒ¤ë¦­*` ìë™ ì œê±°
- âœ… **í›„ë¦¬ê°€ë‚˜ ìë™ ì œê±°**: `ãŠå¸­ï¼ˆã›ãï¼‰` â†’ `ãŠå¸­` ìœ¼ë¡œ ì •ì œ
- âœ… **ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ **: êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²• ì œì‹œ

**ìƒˆë¡œìš´ ê¸°ëŠ¥**:
1. **Pending Queue ì‹œìŠ¤í…œ**
   - TTSê°€ ì¤€ë¹„ë˜ê¸° ì „ ìŒì„± ìš”ì²­ì„ íì— ì €ì¥
   - ì´ˆê¸°í™” ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ì¬ìƒ
   - ì•± ì‹œì‘ ì§í›„ AI ì‘ë‹µë„ ì •ìƒ ì¬ìƒ

2. **ì¼ë³¸ì–´ ìŒì„± ë°ì´í„° ê°ì§€**
   - ë””ë°”ì´ìŠ¤ì— ì¼ë³¸ì–´ TTS ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìë™ ê°ì§€
   - ì„¤ì¹˜ ë°©ë²•ì„ í¬í•¨í•œ ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
   - `ì„¤ì • > ì–¸ì–´ ë° ì…ë ¥ > ìŒì„± ì¶œë ¥ > ì¼ë³¸ì–´ ë‹¤ìš´ë¡œë“œ`

3. **í…ìŠ¤íŠ¸ ìë™ ì •ì œ**
   ```kotlin
   // AI ì‘ë‹µ ì˜ˆì‹œ (ìë™ ì •ì œë¨):
   // Before: "**å†·ãŸã„ï¼ˆã¤ã‚ãŸã„ï¼‰**é£²ã¿ç‰©ï¼ˆã®ã¿ã‚‚ã®ï¼‰"
   // After:  "å†·ãŸã„é£²ã¿ç‰©"
   ```

4. **Thread-Safe ì²˜ë¦¬**
   - ë™ì‹œì„± ë¬¸ì œ í•´ê²°ë¡œ ì•ˆì •ì„± í–¥ìƒ
   - ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œë„ ì•ˆì „í•œ TTS ë™ì‘

**ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì—…ë°ì´íŠ¸**:
- ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ì— í…ìŠ¤íŠ¸ í¬ë§· ê·œì¹™ ì¶”ê°€
- AIê°€ ë§ˆí¬ë‹¤ìš´ê³¼ í›„ë¦¬ê°€ë‚˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ëª…ì‹œì  ì§€ì‹œ
- 3ë‹¨ê³„ ë‚œì´ë„ ë ˆë²¨ ëª¨ë‘ ì ìš©

### ë¹Œë“œ ì„¤ì • ê°œì„ 

**ë©”ëª¨ë¦¬ ì„¤ì •** (`gradle.properties`):
```properties
# OutOfMemoryError ë°©ì§€
org.gradle.jvmargs=-Xmx4096m -XX:MaxMetaspaceSize=512m
org.gradle.daemon=true
org.gradle.parallel=true
```

**ì˜ì¡´ì„± ì—…ë°ì´íŠ¸** (`app/build.gradle.kts`):
```kotlin
// Material Icons ë¼ì´ë¸ŒëŸ¬ë¦¬
implementation("androidx.compose.material:material-icons-core:1.7.4")
implementation("androidx.compose.material:material-icons-extended:1.7.4")
```

## ğŸ› ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### TTSê°€ ì‘ë™í•˜ì§€ ì•Šì„ ë•Œ

**ì¦ìƒ**: ìŒì„±ì´ ì¬ìƒë˜ì§€ ì•Šê±°ë‚˜ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

**í•´ê²° ë°©ë²•**:
1. **ì•± ì™„ì „ ì¬ì„¤ì¹˜** (ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”)
   ```bash
   adb uninstall com.nihongo.conversation
   # Android Studioì—ì„œ ë‹¤ì‹œ ì‹¤í–‰
   ```

2. **ì¼ë³¸ì–´ ìŒì„± ë°ì´í„° ì„¤ì¹˜ í™•ì¸**
   - ë””ë°”ì´ìŠ¤ ì„¤ì • â†’ ì–¸ì–´ ë° ì…ë ¥
   - ìŒì„± ì¶œë ¥ â†’ TTS ì—”ì§„ ì„¤ì •
   - ì¼ë³¸ì–´ ìŒì„± ë°ì´í„° ë‹¤ìš´ë¡œë“œ

3. **ë³¼ë¥¨ í™•ì¸**
   - ë¯¸ë””ì–´ ë³¼ë¥¨ì´ ì¼œì ¸ ìˆëŠ”ì§€ í™•ì¸
   - ë¬´ìŒ ëª¨ë“œ í•´ì œ

4. **ìë™ ìŒì„± ì¬ìƒ ì„¤ì •**
   - ì„¤ì • í™”ë©´ì—ì„œ "ìë™ ì½ê¸°" í† ê¸€ í™•ì¸
   - ì˜¤ë¥¸ìª½ ìƒë‹¨ ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ í™•ì¸

### AIê°€ ì´ìƒí•œ ê¸°í˜¸ë¥¼ í‘œì‹œí•  ë•Œ

**ì¦ìƒ**: `**í…ìŠ¤íŠ¸**` ë˜ëŠ” `ï¼ˆãµã‚ŠãŒãªï¼‰` í‘œì‹œ

**ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ì´ì „ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì‚¬ìš© ì¤‘

**í•´ê²° ë°©ë²•**:
```bash
# ì•± ì¬ì„¤ì¹˜ë¡œ ìƒˆ í”„ë¡¬í”„íŠ¸ ì ìš©
adb uninstall com.nihongo.conversation
# Android Studioì—ì„œ ë‹¤ì‹œ ì‹¤í–‰
```

ì¬ì„¤ì¹˜ í›„ ìë™ìœ¼ë¡œ:
- âœ… ìƒˆë¡œìš´ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì ìš©
- âœ… AI ì‘ë‹µ í…ìŠ¤íŠ¸ ì •ì œ ê¸°ëŠ¥ í™œì„±í™”
- âœ… TTS í›„ë¦¬ê°€ë‚˜ ì œê±° ê¸°ëŠ¥ í™œì„±í™”

### ì‹œë‚˜ë¦¬ì˜¤ ë‚´ìš© í™•ì¸

**"é›»è©±ã§ã®ä¼šè©±" ì‹œë‚˜ë¦¬ì˜¤**:
- ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” **ë ˆìŠ¤í† ë‘/ì‚´ë¡± ì˜ˆì•½ ì „í™” ì—°ìŠµ**ìš©ì…ë‹ˆë‹¤
- AIê°€ "ë ˆìŠ¤í† ë‘ì…ë‹ˆë‹¤"ë¼ê³  ì‘ë‹µí•˜ëŠ” ê²ƒì´ ì •ìƒì…ë‹ˆë‹¤
- ì‚¬ìš©ìëŠ” ì „í™”ë¡œ ì˜ˆì•½í•˜ëŠ” ì—­í• ì„ ì—°ìŠµí•©ë‹ˆë‹¤

**ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±**:
1. ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã§ã®æ³¨æ–‡ - ë ˆìŠ¤í† ë‘ì—ì„œ ì§ì ‘ ì£¼ë¬¸
2. è²·ã„ç‰© - ì‡¼í•‘
3. ãƒ›ãƒ†ãƒ«ã§ã®ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ - í˜¸í…” ì²´í¬ì¸
4. å‹é”ã‚’ä½œã‚‹ - ì¹œêµ¬ ë§Œë“¤ê¸°
5. **é›»è©±ã§ã®ä¼šè©±** - ì „í™”ë¡œ ì˜ˆì•½í•˜ê¸° (ë ˆìŠ¤í† ë‘/ì‚´ë¡±)
6. ç—…é™¢ã§ - ë³‘ì› ë°©ë¬¸

## ğŸ”§ ê°œë°œ ê°€ì´ë“œ

### Claude Code CLI ì‚¬ìš©ë²•

1. **ì„¸ì…˜ ì‹œì‘**
```bash
claude-code "Continue ì¼ë³¸ì–´ íšŒí™” ì•± development"
```

2. **ì»¨í…ìŠ¤íŠ¸ ìœ ì§€**
```bash
# ì²´í¬í¬ì¸íŠ¸ ì €ì¥
.claude/session_manager.sh save

# ì²´í¬í¬ì¸íŠ¸ ë³µì›
.claude/session_manager.sh restore [checkpoint_id]
```

3. **íš¨ìœ¨ì ì¸ ì‘ì—…**
- Sonnet ì‚¬ìš©: UI êµ¬í˜„, í…ŒìŠ¤íŠ¸, ë²„ê·¸ ìˆ˜ì •
- Opus ì‚¬ìš©: ì•„í‚¤í…ì²˜ ì„¤ê³„, ë³µì¡í•œ ë¡œì§

### ë¹Œë“œ ì„¤ì •

```kotlin
// app/build.gradle.kts
android {
    compileSdk = 34
    
    defaultConfig {
        applicationId = "com.nihongo.conversation"
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"
    }
    
    buildFeatures {
        compose = true
        buildConfig = true
    }
}
```

## ğŸ“Š ê°œë°œ ë¡œë“œë§µ

### âœ… Phase 1: MVP (ì™„ë£Œ)
- [x] í”„ë¡œì íŠ¸ ì„¤ì • (Kotlin + Compose + Hilt)
- [x] Gemini API ì—°ë™ (2.5 Flash)
- [x] ê¸°ë³¸ ì±„íŒ… UI (Material 3)
- [x] Room ë°ì´í„°ë² ì´ìŠ¤ (ëŒ€í™”/ë©”ì‹œì§€ ì €ì¥)
- [x] Navigation êµ¬ì¡°

### âœ… Phase 2: í•µì‹¬ ê¸°ëŠ¥ (ì™„ë£Œ)
- [x] STT/TTS í†µí•© (ì¼ë³¸ì–´ ìŒì„± ì¸ì‹/ì¬ìƒ)
- [x] VoiceManager (ìŒì„± ìƒíƒœ ê´€ë¦¬)
- [x] AI íŒíŠ¸ ì‹œìŠ¤í…œ (ë¬¸ë§¥ ê¸°ë°˜ ì œì•ˆ)
- [x] í•œêµ­ì–´-ì¼ë³¸ì–´ ë²ˆì—­ ë‹¤ì´ì–¼ë¡œê·¸
- [x] 6ê°€ì§€ ì‹¤ìƒí™œ ì‹œë‚˜ë¦¬ì˜¤
- [x] ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ í™”ë©´
- [x] ì„¤ì • ì‹œìŠ¤í…œ (DataStore)
- [x] ë‚œì´ë„ ì¡°ì ˆ (1-3 ë ˆë²¨)
- [x] ìŒì„± ì†ë„ ì œì–´ (0.5x-2.0x)
- [x] ChatScreen UX í´ë¦¬ì‹± (ì• ë‹ˆë©”ì´ì…˜, íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°)

### âœ… Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ (ì™„ë£Œ)
- [x] ë³µìŠµ ëª¨ë“œ (ì €ì¥ëœ ëŒ€í™” ì¬ìƒ, ë‚ ì§œ ê·¸ë£¹í™”, ì¤‘ìš” ë¬¸êµ¬)
- [x] í•™ìŠµ í†µê³„ (ì—°ì† í•™ìŠµì¼, ì°¨íŠ¸, ì£¼ê°„/ì›”ê°„ ë·°)
- [x] ì‚¬ìš©ì í”„ë¡œí•„ ì‹œìŠ¤í…œ (ì•„ë°”íƒ€, í•™ìŠµ ëª©í‘œ, ê°œì¸í™”)
- [x] ë‚œì´ë„ë³„ AI ì‘ë‹µ ì¡°ì • (JLPT N5-N1, ì–´íœ˜ ë³µì¡ë„ ë¶„ì„)
- [x] ë¬¸ë²• ì„¤ëª… ê¸°ëŠ¥ (ìƒ‰ìƒ êµ¬ë¬¸ ê°•ì¡°, í•œêµ­ì–´ ì„¤ëª…, ëŒ€í™” ì˜ˆì‹œ)
- [x] ë¬¸ë²• ìºì‹± (ì¦‰ì‹œ ì¬ë¡œë”©)
- [x] ë©”ì‹œì§€ë³„ í•œêµ­ì–´ ë²ˆì—­ ë²„íŠ¼
- [x] ëŒ€í™” ì¢…ë£Œ ë° íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- [x] TTS ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- [x] ëŒ€í™” ì´ë ¥ ë³´ì¡´ (ë„¤ë¹„ê²Œì´ì…˜ ì‹œ)
- [x] ìŠ¤ë§ˆíŠ¸ ëŒ€í™” ìƒì„± (ë¹ˆ ëŒ€í™” ë°©ì§€)

### âœ… Phase 4: ì¶”ê°€ ê¸°ëŠ¥ (ì™„ë£Œ/ì§„í–‰ì¤‘)
- [x] **ë°œìŒ í‰ê°€**: STT ì •í™•ë„ ë¶„ì„, ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬, 0-100 ì ìˆ˜, ìƒ‰ìƒ í”¼ë“œë°±
- [x] **í”Œë˜ì‹œì¹´ë“œ ì‹œìŠ¤í…œ**: ìë™ ì–´íœ˜ ì¶”ì¶œ, SM-2 ê°„ê²© ë°˜ë³µ, ë°ì´í„°ë² ì´ìŠ¤ ì™„ì„± (UI ê°œë°œ ì¤‘)
- [x] **ëŒ€í™” ì´ë ¥ ê´€ë¦¬**: ê²€ìƒ‰, í•„í„°ë§, ë¹ ë¥¸ ì¬ê°œ, í†µê³„ í‘œì‹œ
- [ ] í€´ì¦ˆ ëª¨ë“œ
- [ ] ëª©í‘œ ì„¤ì • ë° ì•Œë¦¼
- [ ] ì†Œì…œ ê³µìœ  ê¸°ëŠ¥

### ğŸ“… Phase 5: í–¥í›„ ê³„íš
- [ ] í”Œë˜ì‹œì¹´ë“œ ë³µìŠµ UI (FlashcardReviewScreen, ViewModel)
- [ ] í”Œë˜ì‹œì¹´ë“œ í†µê³„ ì°¨íŠ¸
- [ ] ë°œìŒ í‰ê°€ íˆìŠ¤í† ë¦¬ ì¶”ì 
- [ ] ì»¤ìŠ¤í…€ ì–´íœ˜ ì¶”ê°€ ê¸°ëŠ¥
- [ ] ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ TTS)
- [ ] ìœ„ì ¯ (í•™ìŠµ ì§„ë„ í‘œì‹œ)

## ğŸ§ª í…ŒìŠ¤íŠ¸

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
./gradlew test

# UI í…ŒìŠ¤íŠ¸
./gradlew connectedAndroidTest

# íŠ¹ì • í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./gradlew test --tests "*.ChatViewModelTest"
```

## ğŸ“‚ ì£¼ìš” íŒŒì¼ êµ¬ì¡°

### Domain Layer (`domain/model/`)
- **User.kt**: ì‚¬ìš©ì ì—”í‹°í‹° (Room @Entity, avatarId, learningGoal, level)
- **Scenario.kt**: ì‹œë‚˜ë¦¬ì˜¤ í…œí”Œë¦¿ (ì œëª©, ì„¤ëª…, ë‚œì´ë„, ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸)
- **Conversation.kt**: ëŒ€í™” ì„¸ì…˜ (userId, scenarioId, isCompleted)
- **Message.kt**: ê°œë³„ ë©”ì‹œì§€ (content, isUser, timestamp, complexityScore)
- **Hint.kt**: AI íŒíŠ¸ (japanese, korean, romaji, explanation)
- **GrammarExplanation.kt**: ë¬¸ë²• ë¶„ì„ (components, overallExplanation, examples, relatedPatterns)
- **GrammarComponent.kt**: ë¬¸ë²• ìš”ì†Œ (text, type, explanation, startIndex, endIndex)
- **GrammarType.kt**: ë¬¸ë²• íƒ€ì… enum (PARTICLE, VERB, ADJECTIVE, etc.)
- **UserSettings.kt**: ì‚¬ìš©ì ì„¤ì • (difficulty, speechSpeed, autoSpeak, showRomaji)
- **VocabularyEntry.kt**: ì–´íœ˜ ì—”í‹°í‹° (word, meaning, SM-2 íŒŒë¼ë¯¸í„°, ë§ˆìŠ¤í„°ë¦¬)
- **ReviewHistory.kt**: ë³µìŠµ ê¸°ë¡ (vocabularyId, quality, timeSpentMs)
- **SpacedRepetition.kt**: SM-2 ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ (ê°„ê²© ê³„ì‚°, ë§ˆìŠ¤í„°ë¦¬ íŒì •)
- **PronunciationPractice.kt**: ë°œìŒ í‰ê°€ (PronunciationResult, WordMatch, ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬)

### Data Layer
#### Local (`data/local/`)
- **NihongoDatabase.kt**: Room ë°ì´í„°ë² ì´ìŠ¤ (6ê°œ DAO, Schema v3)
  - `MIGRATION_1_2`: isCompleted ì»¬ëŸ¼ ì¶”ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜
  - `MIGRATION_2_3`: vocabulary_entries ë° review_history í…Œì´ë¸” ìƒì„±
- **UserDao.kt, ScenarioDao.kt, ConversationDao.kt, MessageDao.kt**: ë°ì´í„° ì ‘ê·¼ ì¸í„°í˜ì´ìŠ¤
  - `getLatestActiveConversationByUserAndScenario()`: í™œì„± ëŒ€í™” ì¡°íšŒ
  - `getCompletedConversationsByUserAndScenario()`: ì™„ë£Œëœ ëŒ€í™” ì¡°íšŒ
- **VocabularyDao.kt**: ì–´íœ˜ ë°ì´í„° ì ‘ê·¼
  - `getDueForReview()`: ë³µìŠµ ì˜ˆì • ë‹¨ì–´ ì¡°íšŒ
  - `getNewWords()`: ì‹ ê·œ ë‹¨ì–´ ì¡°íšŒ
  - `getAverageQuality()`: í‰ê·  ì •í™•ë„ ê³„ì‚°
- **SettingsDataStore.kt**: DataStore Preferences ê´€ë¦¬
- **DataInitializer.kt**: 6ê°€ì§€ ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤ ì´ˆê¸°í™”

#### Remote (`data/remote/`)
- **GeminiApiService.kt**: Gemini 2.5 Flash API í´ë¼ì´ì–¸íŠ¸
  - `sendMessage()`: AI ëŒ€í™” ìƒì„±
  - `generateHints()`: ë¬¸ë§¥ ê¸°ë°˜ íŒíŠ¸ ìƒì„± (JSON íŒŒì‹±)

#### Repository (`data/repository/`)
- **ConversationRepository.kt**: í†µí•© ë°ì´í„° ê´€ë¦¬
  - Room DB + Gemini API í†µí•©
  - Flow ê¸°ë°˜ ë¦¬ì•¡í‹°ë¸Œ ë°ì´í„°
  - `getOrCreateConversation()`: ëŒ€í™” ì„¸ì…˜ ë³µì› ë˜ëŠ” ìƒì„±
  - `completeConversation()`: ëŒ€í™” ì¢…ë£Œ ë° íˆìŠ¤í† ë¦¬ ì €ì¥
  - `translateToKorean()`: ì¼ë³¸ì–´ â†’ í•œêµ­ì–´ ë²ˆì—­
- **StatsRepository.kt**: í•™ìŠµ í†µê³„ ê³„ì‚°
  - ì¼ì¼/ì£¼ê°„/ì›”ê°„ í†µê³„
  - ì—°ì† í•™ìŠµì¼ ì¶”ì 
  - ì‹œë‚˜ë¦¬ì˜¤ë³„ ì§„í–‰ë¥ 
  - í•™ìŠµ ì‹œê°„ ì¶”ì •
- **VocabularyRepository.kt**: ì–´íœ˜ ê´€ë¦¬
  - `extractVocabularyFromConversation()`: ëŒ€í™”ì—ì„œ ì–´íœ˜ ì¶”ì¶œ
  - `getReviewSession()`: ë³µìŠµ ì„¸ì…˜ ìƒì„± (SM-2 ê¸°ë°˜)
  - `submitReview()`: ë³µìŠµ ê²°ê³¼ ì œì¶œ ë° ë‹¤ìŒ ê°„ê²© ê³„ì‚°
  - `getVocabularyStats()`: ì–´íœ˜ í•™ìŠµ í†µê³„

### Presentation Layer
#### Chat (`presentation/chat/`)
- **ChatScreen.kt**: ë©”ì¸ ì±„íŒ… UI (500+ lines)
  - ChatScreen, MessageBubble, MessageInput composables
  - AnimatedVisibility, íƒ€ì„ìŠ¤íƒ¬í”„, ì—ëŸ¬ í‘œì‹œ
  - ëŒ€í™” ì¢…ë£Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
  - ë©”ì‹œì§€ë³„ ë²ˆì—­ ë²„íŠ¼
  - ë°œìŒ ì—°ìŠµ ë²„íŠ¼
- **ChatViewModel.kt**: ì±„íŒ… ìƒíƒœ ê´€ë¦¬
  - ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹ , ìŒì„± ì´ë²¤íŠ¸, íŒíŠ¸ ìš”ì²­
  - Settings ê´€ì°° ë° VoiceManager ì—°ë™
  - `confirmEndChat()`: ëŒ€í™” ì¢…ë£Œ ë° ìƒíƒœ ì´ˆê¸°í™”
  - `startNewChat()`: ìƒˆ ëŒ€í™” ì‹œì‘ (í† ìŠ¤íŠ¸ í¬í•¨)
  - `toggleMessageTranslation()`: ë©”ì‹œì§€ë³„ ë²ˆì—­ í† ê¸€
  - `requestGrammarExplanation()`: ë¬¸ë²• ì„¤ëª… (ìºì‹± ì§€ì›)
  - `startPronunciationPractice()`: ë°œìŒ ì—°ìŠµ ì‹œì‘
  - `checkPronunciation()`: ë°œìŒ ì •í™•ë„ ë¶„ì„
- **PronunciationPracticeSheet.kt**: ë°œìŒ ì—°ìŠµ UI (400+ lines)
  - Target text í‘œì‹œ ë° TTS ì¬ìƒ
  - ë…¹ìŒ ë²„íŠ¼ (í° FloatingActionButton)
  - ì •í™•ë„ ì ìˆ˜ ì¹´ë“œ (0-100)
  - ìƒ‰ìƒë³„ í”¼ë“œë°± (ì •í™•/ê·¼ì ‘/ë¶ˆì¼ì¹˜/ëˆ„ë½)
  - ì¬ì‹œë„ ë° ì™„ë£Œ ë²„íŠ¼
- **TypingIndicator.kt**: 3-dot í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜
- **VoiceButton.kt**: ë§ˆì´í¬ ë²„íŠ¼ + í„ìŠ¤ íš¨ê³¼
- **HintDialog.kt**: íŒíŠ¸ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸
- **GrammarBottomSheet.kt**: ë¬¸ë²• ì„¤ëª… ì‹œíŠ¸
- **VoiceStateIndicator.kt**: ìŒì„± ìƒíƒœ í‘œì‹œ

#### Scenario (`presentation/scenario/`)
- **ScenarioListScreen.kt**: ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ í™”ë©´
  - ScenarioCard, DifficultyBadge, ì•„ì´ì½˜ ë§¤í•‘
- **ScenarioViewModel.kt**: ì‹œë‚˜ë¦¬ì˜¤ ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬

#### Settings (`presentation/settings/`)
- **SettingsScreen.kt**: ì„¤ì • UI
  - DifficultySlider, SpeechSpeedSlider, SettingsToggle
  - ì„¹ì…˜ë³„ ë ˆì´ì•„ì›ƒ (Material 3)
- **SettingsViewModel.kt**: ì„¤ì • ìƒíƒœ ê´€ë¦¬ (DataStore ì—°ë™)

#### Review (`presentation/review/`)
- **ReviewScreen.kt**: ë³µìŠµ ëª¨ë“œ UI (480+ lines)
  - ë‚ ì§œë³„ ëŒ€í™” ê·¸ë£¹í™”
  - í™•ì¥ ê°€ëŠ¥ ëŒ€í™” ì¹´ë“œ
  - ì¤‘ìš” ë¬¸êµ¬ ì¶”ì¶œ ë° ì¬ìƒ
- **ReviewViewModel.kt**: ë³µìŠµ ìƒíƒœ ê´€ë¦¬
  - ëŒ€í™” ë¡œë”© ë° ê·¸ë£¹í™”
  - ì¤‘ìš” ë¬¸êµ¬ ì¶”ì¶œ ë¡œì§
  - TTS ì¬ìƒ ì œì–´

#### Stats (`presentation/stats/`)
- **StatsScreen.kt**: í†µê³„ ëŒ€ì‹œë³´ë“œ UI (450+ lines)
  - ì—°ì† í•™ìŠµì¼ ì¹´ë“œ
  - ì´ê³„ í†µê³„ (íšŒí™”/ë©”ì‹œì§€/ì‹œê°„)
  - ì£¼ê°„/ì›”ê°„ ë·° í† ê¸€
- **StatsViewModel.kt**: í†µê³„ ìƒíƒœ ê´€ë¦¬
  - StatsRepository ì—°ë™
  - ê¸°ê°„ë³„ ë°ì´í„° í•„í„°ë§
- **Charts.kt**: ì°¨íŠ¸ ì»´í¬ë„ŒíŠ¸ (320+ lines)
  - BarChart (ë§‰ëŒ€ ì°¨íŠ¸)
  - LineChart (ì„  ì°¨íŠ¸)
  - PieChart (íŒŒì´ ì°¨íŠ¸)
  - ChartLegend, StatCard

#### History (`presentation/history/`)
- **ConversationHistoryScreen.kt**: ëŒ€í™” ì´ë ¥ UI (550+ lines)
  - ê²€ìƒ‰ ë°” (ì‹¤ì‹œê°„ í•„í„°ë§)
  - í•„í„° ì¹© (ìƒíƒœ/ì‹œë‚˜ë¦¬ì˜¤)
  - ëŒ€í™” ì¹´ë“œ (ì œëª©, ìƒíƒœ, ë¯¸ë¦¬ë³´ê¸°, í†µê³„)
  - ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ (ê³„ì†/ì¬ê°œ/ì‚­ì œ)
  - ë¹ˆ ìƒíƒœ ì²˜ë¦¬
  - ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
  - ì‹œë‚˜ë¦¬ì˜¤ í•„í„° ëª¨ë‹¬
- **ConversationHistoryViewModel.kt**: ì´ë ¥ ìƒíƒœ ê´€ë¦¬
  - ëŒ€í™” ë¡œë”© ë° í•„í„°ë§
  - ê²€ìƒ‰ ì¿¼ë¦¬ ì²˜ë¦¬
  - ë‚ ì§œ í¬ë§·íŒ… (ì˜¤ëŠ˜/ì–´ì œ/ë‚ ì§œ)
  - ì§€ì† ì‹œê°„ í¬ë§·íŒ…

#### Navigation (`presentation/navigation/`)
- **NihongoNavHost.kt**: Navigation Compose ë¼ìš°íŒ…
  - ScenarioList (ì‹œì‘) â†’ Chat / Settings / Stats / Review
- **Screen.kt**: ë¼ìš°íŠ¸ ì •ì˜

### Core Layer (`core/`)
#### DI (`core/di/`)
- **DatabaseModule.kt**: Room DB Hilt ì œê³µ
- **AppModule.kt**: Context, Gemini API Hilt ì œê³µ
- **VoiceModule.kt**: VoiceManager Singleton ì œê³µ

#### Voice (`core/voice/`)
- **VoiceManager.kt**: STT/TTS í†µí•© ê´€ë¦¬
  - Android SpeechRecognizer (ì¼ë³¸ì–´ ja-JP)
  - TextToSpeech (ì†ë„ ì œì–´ 0.5x-2.0x, ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜)
  - Pending queue ì‹œìŠ¤í…œ (ë¹„ë™ê¸° ì´ˆê¸°í™” ë¬¸ì œ í•´ê²°)
  - StateFlow ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬
  - `retryTtsInitialization()`: TTS ì¬ì´ˆê¸°í™” í•¨ìˆ˜
- **VoiceState.kt**: Idle, Listening, Speaking ìƒíƒœ
- **VoiceEvent.kt**: RecognitionResult, Error, SpeakingComplete ì´ë²¤íŠ¸

#### Util (`core/util/`)
- **Result.kt**: Success/Error/Loading sealed class
- **VocabularyExtractor.kt**: ëŒ€í™”ì—ì„œ ì–´íœ˜ ì¶”ì¶œ
  - `extractFromMessages()`: AI ë©”ì‹œì§€ì—ì„œ ì¤‘ìš” ë‹¨ì–´ ìë™ ì¶”ì¶œ
  - `isImportantWord()`: ì¼ë°˜ì ì¸ ì¡°ì‚¬/ë™ì‚¬ í•„í„°ë§
  - `estimateDifficulty()`: í•œì/ì¹´íƒ€ì¹´ë‚˜ ê¸°ë°˜ ë‚œì´ë„ ì¶”ì •

### Application (`NihongoApp.kt`)
- Hilt Application ì§„ì…ì 
- DataInitializerë¡œ ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤ ì‚½ì…

**ì´ íŒŒì¼ ìˆ˜**: 55+ Kotlin íŒŒì¼
- Domain: 13 ëª¨ë¸ (+4 ì‹ ê·œ)
- Data: 9 DAO/Repository (+2 ì‹ ê·œ)
- Presentation: 25+ í™”ë©´/ViewModel (+3 ì‹ ê·œ)
- Core: 8 ìœ í‹¸ë¦¬í‹° (+1 ì‹ ê·œ)

## ğŸ”‘ í•µì‹¬ êµ¬í˜„ í¬ì¸íŠ¸

### 1. Gemini API í†µí•© + í…ìŠ¤íŠ¸ ì •ì œ
```kotlin
// GeminiApiService.kt
val generativeModel = GenerativeModel(
    modelName = "gemini-2.5-flash",
    apiKey = BuildConfig.GEMINI_API_KEY
)

// ëŒ€í™” íˆìŠ¤í† ë¦¬ë¥¼ í¬í•¨í•œ ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
val chat = generativeModel.startChat(history = conversationHistory)
val response = chat.sendMessage(userMessage)

// ğŸ†• ì‘ë‹µ í…ìŠ¤íŠ¸ ìë™ ì •ì œ
private fun cleanResponseText(text: String): String {
    return text
        .replace(Regex("\\*\\*([^*]+)\\*\\*"), "$1")  // **êµµê²Œ** ì œê±°
        .replace(Regex("(?<!\\*)\\*([^*]+)\\*(?!\\*)"), "$1")  // *ê¸°ìš¸ì„* ì œê±°
        .replace(Regex("ï¼ˆ[^ï¼‰]*ï¼‰"), "")  // ï¼ˆí›„ë¦¬ê°€ë‚˜ï¼‰ ì œê±°
        .replace(Regex("\\([^)]*\\)"), "")  // (furigana) ì œê±°
}
```

### 2. ë¦¬ì•¡í‹°ë¸Œ Settings ë™ê¸°í™”
```kotlin
// ChatViewModelì—ì„œ Settings ê´€ì°°
private fun observeSettings() {
    viewModelScope.launch {
        settingsDataStore.userSettings.collect { settings ->
            _uiState.update {
                it.copy(
                    autoSpeak = settings.autoSpeak,
                    speechSpeed = settings.speechSpeed
                )
            }
            voiceManager.setSpeechSpeed(settings.speechSpeed)
        }
    }
}
```

### 3. ìŒì„± ì¸ì‹/ì¬ìƒ ìƒíƒœ ê´€ë¦¬ + TTS ê°œì„ 
```kotlin
// VoiceManager.kt - StateFlow ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬
private val _state = MutableStateFlow<VoiceState>(VoiceState.Idle)
val state: StateFlow<VoiceState> = _state.asStateFlow()

// ğŸ†• Pending Queue ì‹œìŠ¤í…œ (ë¹„ë™ê¸° ì´ˆê¸°í™” ë¬¸ì œ í•´ê²°)
private val pendingSpeechQueue = mutableListOf<PendingSpeech>()

fun speak(text: String, speed: Float = 1.0f) {
    // í›„ë¦¬ê°€ë‚˜ ìë™ ì œê±°
    val cleanText = text.replace(Regex("ï¼ˆ[^ï¼‰]*ï¼‰|\\([^)]*\\)"), "").trim()

    if (!isTtsInitialized) {
        // TTS ì¤€ë¹„ ì „ - íì— ì €ì¥
        synchronized(pendingSpeechQueue) {
            pendingSpeechQueue.add(PendingSpeech(cleanText, utteranceId, speed))
        }
        return
    }

    // TTS ì¤€ë¹„ ì™„ë£Œ - ì¦‰ì‹œ ì¬ìƒ
    textToSpeech?.speak(cleanText, TextToSpeech.QUEUE_FLUSH, null, utteranceId)
}

// ì´ˆê¸°í™” ì™„ë£Œ ì‹œ í ì²˜ë¦¬
private fun initializeTts() {
    textToSpeech = TextToSpeech(context) { status ->
        if (status == TextToSpeech.SUCCESS) {
            // ì¼ë³¸ì–´ ì„¤ì • ë° ì¤€ë¹„ ì™„ë£Œ
            isTtsInitialized = true

            // ğŸ†• ëŒ€ê¸° ì¤‘ì¸ ìŒì„± ì¬ìƒ
            synchronized(pendingSpeechQueue) {
                pendingSpeechQueue.forEach { pending ->
                    textToSpeech?.speak(pending.text, ...)
                }
                pendingSpeechQueue.clear()
            }
        }
    }
}

// UIì—ì„œ ìƒíƒœ êµ¬ë…
val voiceState by viewModel.voiceState.collectAsState()
```

### 4. AI íŒíŠ¸ ìƒì„± (JSON íŒŒì‹±)
```kotlin
// GeminiApiService.kt
suspend fun generateHints(conversationHistory: List<Message>): List<Hint> {
    val prompt = """
    Based on this conversation, suggest 3 helpful Japanese phrases...
    Return ONLY a JSON array with this exact format:
    [{"japanese": "...", "korean": "...", "romaji": "...", "explanation": "..."}]
    """

    val response = generativeModel.generateContent(prompt)
    // JSON íŒŒì‹± with fallback hints
}
```

### 5. Compose ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”
```kotlin
// TypingIndicator.kt - rememberë¡œ ì• ë‹ˆë©”ì´ì…˜ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
val infiniteTransition = rememberInfiniteTransition(label = "typing")

// ChatScreen.kt - í‚¤ ê¸°ë°˜ ì•„ì´í…œ ì¶”ì ìœ¼ë¡œ ì¬ì¡°í•© ìµœì†Œí™”
items(items = uiState.messages, key = { it.id }) { message ->
    AnimatedVisibility(...)
}
```

### 6. DataStore Preferences íŒ¨í„´
```kotlin
// SettingsDataStore.kt
private val Context.dataStore: DataStore<Preferences>
    by preferencesDataStore(name = "settings")

val userSettings: Flow<UserSettings> = context.dataStore.data
    .catch { if (it is IOException) emit(emptyPreferences()) }
    .map { preferences ->
        UserSettings(
            difficultyLevel = preferences[DIFFICULTY_LEVEL] ?: 1,
            speechSpeed = preferences[SPEECH_SPEED] ?: 1.0f,
            // ...
        )
    }
```

### 7. Room ê´€ê³„í˜• ì¿¼ë¦¬
```kotlin
// ConversationDao.kt
@Query("""
    SELECT * FROM conversations
    WHERE userId = :userId
    ORDER BY createdAt DESC
""")
fun getConversationsByUser(userId: Long): Flow<List<Conversation>>

// MessageDao.kt - Foreign Key ê´€ê³„
@Entity(
    foreignKeys = [ForeignKey(
        entity = Conversation::class,
        parentColumns = ["id"],
        childColumns = ["conversationId"],
        onDelete = ForeignKey.CASCADE
    )]
)
```

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

ê°œì¸ í”„ë¡œì íŠ¸ì´ì§€ë§Œ í”¼ë“œë°±ê³¼ ì œì•ˆì€ í™˜ì˜í•©ë‹ˆë‹¤!

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License - ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ì„¸ìš”

## ğŸ“® ì—°ë½ì²˜

- Email: your.email@example.com
- Project Link: [https://github.com/yourusername/nihongo-conversation](https://github.com/yourusername/nihongo-conversation)

## ğŸ™ ê°ì‚¬ì˜ ë§

- Google Gemini Team - ê°•ë ¥í•œ AI API ì œê³µ
- Android Jetpack Team - í˜„ëŒ€ì ì¸ Android ê°œë°œ ë„êµ¬
- ì¼ë³¸ì–´ í•™ìŠµ ì»¤ë®¤ë‹ˆí‹° - í”¼ë“œë°±ê³¼ ì•„ì´ë””ì–´

---

**Note**: ì´ ì•±ì€ ê°œì¸ í•™ìŠµìš©ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì—…ì  ì‚¬ìš© ì‹œ Gemini API ë¼ì´ì„ ìŠ¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.